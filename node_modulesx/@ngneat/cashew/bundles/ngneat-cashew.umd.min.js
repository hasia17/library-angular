!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators"),require("@angular/common/http"),require("@angular/core")):"function"==typeof define&&define.amd?define("@ngneat/cashew",["exports","rxjs","rxjs/operators","@angular/common/http","@angular/core"],e):e((t.ngneat=t.ngneat||{},t.ngneat.cashew={}),t.rxjs,t.rxjs.operators,t.ng.common.http,t.ng.core)}(this,function(t,y,g,d,e){"use strict";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var i=function(){return(i=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function u(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,a=r.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(o=a.next()).done;)i.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(n)throw n.error}}return i}var r,n=function L(){},a=(function F(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(s,r=n),s.prototype.serialize=function(t){return t.customKey||t.urlWithParams},s);function s(){return null!==r&&r.apply(this,arguments)||this}var c={strategy:"explicit",ttl:36e5,localStorageKey:"httpCache"};var p=new e.InjectionToken("HTTP_CACHE_CONFIG");function h(t,e){var r,o;try{for(var n=function s(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}(Array.from(e)),a=n.next();!a.done;a=n.next()){var i=u(a.value,1)[0];if(t.test(i)){e["delete"](i);break}}}catch(c){r={error:c}}finally{try{a&&!a.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}}var l=function J(){},f=(v.prototype.has=function(t){return this.cache.has(t)},v.prototype.get=function(t){return this.cache.get(t)},v.prototype.set=function(t,e){this.cache.set(t,e)},v.prototype["delete"]=function(t){t?"string"!=typeof t?h(t,this.cache):this.cache["delete"](t):this.cache.clear()},v.decorators=[{type:e.Injectable}],v);function v(){this.cache=new Map}var m=function Q(){},C=(S.prototype.isValid=function(t){return this.cache.get(t)>(new Date).getTime()},S.prototype.set=function(t,e){var r=e||this.config.ttl;this.cache.set(t,(new Date).setMilliseconds(r))},S.prototype["delete"]=function(t){t?"string"!=typeof t?h(t,this.cache):this.cache["delete"](t):this.cache.clear()},S.decorators=[{type:e.Injectable}],S.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[p]}]}]},S);function S(t){this.config=t,this.cache=new Map}var b=function B(){},j=(K.prototype.canActivate=function(t){return"GET"===t.method&&"json"===t.responseType},K);function K(){}var _=(w.prototype.get=function(t){return this.queue.get(t)},w.prototype.has=function(t){return this.queue.has(t)},w.prototype.set=function(t,e){this.queue.set(t,e)},w.prototype["delete"]=function(t){this.queue["delete"](t)},w.decorators=[{type:e.Injectable}],w);function w(){this.queue=new Map}var M=(I.prototype.add=function(t){this.keys.add(t)},I.prototype.has=function(t){return this.keys.has(t)},I.prototype.forEach=function(t){this.keys.forEach(t)},I.prototype["delete"]=function(t){this.keys["delete"](t)},I.prototype.clear=function(){this.keys.clear()},I);function I(){this.keys=new Set}var T=(k.prototype.validate=function(t){var e=this.storage.has(t),r=this.ttlManager.isValid(t);return!(!e||!r)||(this.storage["delete"](t),!1)},k.prototype.get=function(t){return this._resolveResponse(this.storage.get(t))},k.prototype.has=function(t){return this.storage.has(t)},k.prototype.set=function(t,e,r){var o=void 0===r?{}:r,n=o.ttl,a=o.bucket,i=e;e instanceof d.HttpResponse||(i=new d.HttpResponse({body:e,status:200,url:t})),this._set(t,i,n),a&&a.add(t)},k.prototype["delete"]=function(t){var e=this;if(t instanceof M)return t.forEach(function(t){return e["delete"](t)}),void t.clear();this.storage["delete"](t),this.ttlManager["delete"](t)},k.prototype._getQueue=function(){return this.queue},k.prototype._isCacheable=function(t,e){var r=this.config.strategy;return"explicit"===r?e:!(!t||"implicit"!==r)&&!1!==e},k.prototype._set=function(t,e,r){this.storage.set(t,e),this.ttlManager.set(t,r)},k.prototype._canActivate=function(t){return this.guard.canActivate(t)},k.prototype._resolveResponse=function(t){return this.config.responseSerializer?t.clone({body:this.config.responseSerializer(t.body)}):t},k.decorators=[{type:e.Injectable}],k.ctorParameters=function(){return[{type:_},{type:l},{type:b},{type:m},{type:undefined,decorators:[{type:e.Inject,args:[p]}]}]},k);function k(t,e,r,o,n){this.queue=t,this.storage=e,this.guard=r,this.ttlManager=o,this.config=n}var H=["ttl$","cache$","key$","bucket$","parameterCodec$"];function x(t,e,r){var o=function a(r){return r.params.keys().reduce(function(t,e){return!1===H.includes(e)&&(t[e]=r.params.getAll(e)),t},{})}(t),n=t.clone({params:new d.HttpParams(i({fromObject:o},r&&{encoder:r}))});return n.customKey=e,n}var O=(P.prototype.intercept=function(t,e){var r=this,o=this.httpCacheManager._canActivate(t),n=t.params.get("cache$"),a=t.params.get("ttl$"),i=t.params.get("key$"),s=t.params.get("bucket$"),c=t.params.get("parameterCodec$"),u=this.config.parameterCodec,p=x(t,i,c||u),h=this.keySerializer.serialize(p),l=this.httpCacheManager._getQueue();if(this.httpCacheManager._isCacheable(o,n)){if(s&&s.add(h),l.has(h))return l.get(h);if(this.httpCacheManager.validate(h))return y.of(this.httpCacheManager.get(h));var f=e.handle(p).pipe(g.tap(function(t){if(t instanceof d.HttpResponse){var e=r.httpCacheManager._resolveResponse(t);r.httpCacheManager._set(h,e,+a)}}),g.finalize(function(){l["delete"](h)}),g.share());return l.set(h,f),f}return e.handle(p)},P.decorators=[{type:e.Injectable}],P.ctorParameters=function(){return[{type:T},{type:n},{type:undefined,decorators:[{type:e.Inject,args:[p]}]}]},P);function P(t,e,r){this.httpCacheManager=t,this.keySerializer=e,this.config=r}var q=(z.forRoot=function(t){return void 0===t&&(t={}),{providers:[{provide:p,useValue:i({},c,t)},{provide:n,useClass:a},{provide:l,useClass:f},{provide:m,useClass:C},{provide:b,useClass:j},{provide:d.HTTP_INTERCEPTORS,useClass:O,multi:!0},T,_],ngModule:z}},z.decorators=[{type:e.NgModule,args:[{}]}],z);function z(){}function $(t,e){localStorage.setItem(t,JSON.stringify(function r(t){return Array.from(t).reduce(function(t,e){var r=u(e,2),o=r[0],n=r[1];return t[o]=n,t},{})}(e)))}function A(t){var e=JSON.parse(localStorage.getItem(t)||"{}"),r=new Map;return Object.keys(e).forEach(function(t){return r.set(t,e[t])}),r}function R(t){localStorage.removeItem(t)}var D=(E.prototype.has=function(t){return this.cache.has(t)||A(this.storageKey).has(t)},E.prototype.get=function(t){var e=this.cache.get(t);if(e)return e;var r=A(this.storageKey).get(t);if(r){var o=new d.HttpResponse(r);this.cache.set(t,o)}return this.cache.get(t)},E.prototype.set=function(t,e){var r=A(this.storageKey);r.set(t,e),$(this.storageKey,r),this.cache.set(t,e)},E.prototype["delete"]=function(t){if(this.cache["delete"](t),t){var e=A(this.storageKey);if("string"==typeof t)return e["delete"](t),void $(this.storageKey,e);h(t,e),$(this.storageKey,e)}else R(this.storageKey)},E.decorators=[{type:e.Injectable}],E.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[p]}]}]},E);function E(t){this.config=t,this.cache=new f,this.storageKey=t.localStorageKey}var N=(G.prototype.isValid=function(t){if(this.ttl.isValid(t))return!0;var e=A(this.ttlStorageKey).get(t),r=e>(new Date).getTime();return r&&this.ttl.set(t,e-(new Date).getTime()),r},G.prototype.set=function(t,e){var r=e||this.config.ttl,o=A(this.ttlStorageKey);o.set(t,(new Date).setMilliseconds(r)),$(this.ttlStorageKey,o),this.ttl.set(t,r)},G.prototype["delete"]=function(t){if(this.ttl["delete"](t),t){if("string"==typeof t){var e=A(this.ttlStorageKey);return e["delete"](t),void $(this.ttlStorageKey,e)}var r=A(this.ttlStorageKey);h(t,r),$(this.ttlStorageKey,r)}else R(this.ttlStorageKey)},G.decorators=[{type:e.Injectable}],G.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[p]}]}]},G);function G(t){this.config=t,this.ttlStorageKey=t.localStorageKey+"TTL",this.ttl=new C(t)}var V=[{provide:l,useClass:D},{provide:m,useClass:N}];t.KeySerializer=n,t.DefaultKeySerializer=a,t.HttpCacheManager=T,t.HttpCacheInterceptor=O,t.HttpCacheGuard=b,t.DefaultHttpCacheGuard=j,t.withCache=function W(t){return void 0===t&&(t={}),{params:i({cache$:!0},t)}},t.cashewConfig=function U(t){return void 0===t&&(t=c),{strategy:t.strategy||c.strategy,ttl:t.ttl||c.ttl,localStorageKey:t.localStorageKey||c.localStorageKey,responseSerializer:t.responseSerializer,parameterCodec:t.parameterCodec}},t.defaultConfig=c,t.HTTP_CACHE_CONFIG=p,t.TTLManager=m,t.DefaultTTLManager=C,t.HttpCacheStorage=l,t.DefaultHttpCacheStorage=f,t.HttpCacheInterceptorModule=q,t.CacheBucket=M,t.useHttpCacheLocalStorage=V,t.ɵb=D,t.ɵc=N,t.ɵa=_,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngneat-cashew.umd.min.js.map