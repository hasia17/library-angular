import { Component, EventEmitter, Inject, Input, Output } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { AUTH_SERVICE } from '../../api/injection-tokens';
import { DEFAULT_AVATAR_URL } from '../constants';
import { Router } from '@angular/router';
import { ConfigurationService } from '../../api/configuration.service';
export class AppInlineProfileComponent {
    constructor(authService, router, configService) {
        this.authService = authService;
        this.router = router;
        this.configService = configService;
        this.defaultAvatarUrl = DEFAULT_AVATAR_URL;
        this.inlineMenuClick = new EventEmitter();
    }
    get displayName() {
        var _a;
        const person = (_a = this.userProfile) === null || _a === void 0 ? void 0 : _a.person;
        if (person === null || person === void 0 ? void 0 : person.displayName) {
            return person.displayName;
        }
        else if ((person === null || person === void 0 ? void 0 : person.firstName) && person.lastName) {
            return person.firstName + ' ' + person.lastName;
        }
        else {
            return this.authService.currentUser().userId;
        }
    }
    get baseUrl() {
        return this.configService.getPortalData().baseUrl;
    }
    get tabIndex() {
        return !this.inlineMenuActive ? '-1' : null;
    }
    ngOnInit() {
        this.userProfile = this.authService.currentUser();
        this.authService
            .getAvatar()
            .subscribe(avatar => (this.userAvatar = avatar));
    }
    onClick(event) {
        this.inlineMenuClick.emit(null);
        event.preventDefault();
    }
    logout(event) {
        event.preventDefault();
        this.authService.logout();
    }
}
AppInlineProfileComponent.decorators = [
    { type: Component, args: [{
                selector: 'tk-inline-profile',
                template: "<div [ngClass]=\"{'layout-inline-menu': true, 'layout-inline-menu-active': inlineMenuActive}\">\n  <a class=\"layout-inline-menu-action p-d-flex p-dir-row p-ai-center p-p-3\" (click)=\"onClick($event)\">\n    <img [src]=\"userAvatar?.avatarSmallImageUrl || defaultAvatarUrl\" alt=\"avatar\" class=\"profile-image\" />\n    <span class=\"p-d-flex p-flex-column p-ml-2\">\n      <span class=\"p-text-bold\">{{ displayName }}</span>\n      <small>Portal User</small>\n    </span>\n    <i class=\"layout-inline-menu-icon pi pi-angle-down p-ml-auto\"></i>\n  </a>\n\n  <ul class=\"layout-inline-menu-action-panel\" [@menu]=\"inlineMenuActive ? 'visibleAnimated' : 'hiddenAnimated'\">\n    <li *tkIfPerm=\"'PROFILE#VIEW'\" class=\"layout-inline-menu-action-item\">\n      <a\n        class=\"p-d-flex p-flex-row p-ai-center\"\n        [attr.tabindex]=\"tabIndex\"\n        [href]=\"baseUrl + '/account/profile'\"\n        title=\"Manage your personal information and avatar\"\n      >\n        <i class=\"pi pi-user pi-fw\"></i>\n        <span>My Personal Info</span>\n      </a>\n    </li>\n    <li class=\"layout-inline-menu-action-item\">\n      <a\n        class=\"p-d-flex p-flex-row p-ai-center\"\n        [attr.tabindex]=\"tabIndex\"\n        [href]=\"baseUrl + '/account/settings'\"\n        title=\"Manage your preferences and settings\"\n      >\n        <i class=\"pi pi-cog pi-fw\"></i>\n        <span>My Settings</span>\n      </a>\n    </li>\n    <li class=\"layout-inline-menu-action-item\">\n      <a\n        class=\"p-d-flex p-flex-row p-ai-center\"\n        [attr.tabindex]=\"tabIndex\"\n        [href]=\"baseUrl + '/account/change-password'\"\n        title=\"Change your current password\"\n      >\n        <i class=\"pi pi-key pi-fw\"></i>\n        <span>Change Password</span>\n      </a>\n    </li>\n    <li class=\"layout-inline-menu-action-item\">\n      <a\n        class=\"p-d-flex p-flex-row p-ai-center\"\n        [attr.tabindex]=\"tabIndex\"\n        [href]=\"baseUrl + '/account/roles-and-perms'\"\n        title=\"Overview of your application roles and permissions\"\n      >\n        <i class=\"pi pi-unlock pi-fw\"></i>\n        <span>My Roles & Permissions</span>\n      </a>\n    </li>\n    <li class=\"layout-inline-menu-action-item\">\n      <a class=\"p-d-flex p-flex-row p-ai-center\" [attr.tabindex]=\"tabIndex\" href=\"#\" (click)=\"logout($event)\">\n        <i class=\"pi pi-power-off pi-fw\"></i>\n        <span>Logout</span>\n      </a>\n    </li>\n  </ul>\n</div>\n",
                animations: [
                    trigger('menu', [
                        state('hiddenAnimated', style({
                            height: '0px',
                            paddingBottom: '0px',
                            overflow: 'hidden'
                        })),
                        state('visibleAnimated', style({
                            height: '*',
                            overflow: 'visible'
                        })),
                        state('visible', style({
                            opacity: 1,
                            'z-index': 100
                        })),
                        state('hidden', style({
                            opacity: 0,
                            'z-index': '*'
                        })),
                        transition('visibleAnimated => hiddenAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                        transition('hiddenAnimated => visibleAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                        transition('visible => hidden', animate('.1s linear')),
                        transition('hidden => visible', [style({ transform: 'scaleY(0.8)' }), animate('.12s cubic-bezier(0, 0, 0.2, 1)')])
                    ])
                ],
                styles: ["@-webkit-keyframes opacityFadeIn{0%{opacity:0}to{opacity:1}}@keyframes opacityFadeIn{0%{opacity:0}to{opacity:1}}.profile-content{-webkit-animation:opacityFadeIn .2s linear 0s 1;animation:opacityFadeIn .2s linear 0s 1}.profile-image{border-radius:50%;width:32px;height:32px}"]
            },] }
];
AppInlineProfileComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [AUTH_SERVICE,] }] },
    { type: Router },
    { type: ConfigurationService }
];
AppInlineProfileComponent.propDecorators = {
    inlineMenuActive: [{ type: Input }],
    inlineMenuClick: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5saW5lLXByb2ZpbGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9ydGFsLWxpYi9zcmMvbGliL3RraXQtcG9ydGFsL2NvbXBvbmVudHMvaW5saW5lLXByb2ZpbGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3JGLE9BQU8sRUFDTCxPQUFPLEVBQ1AsS0FBSyxFQUNMLEtBQUssRUFDTCxVQUFVLEVBQ1YsT0FBTyxFQUNSLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRzFELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUVsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFnQ3ZFLE1BQU0sT0FBTyx5QkFBeUI7SUE4QnBDLFlBQ2dDLFdBQXlCLEVBQy9DLE1BQWMsRUFDZCxhQUFtQztRQUZiLGdCQUFXLEdBQVgsV0FBVyxDQUFjO1FBQy9DLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxrQkFBYSxHQUFiLGFBQWEsQ0FBc0I7UUFoQzdDLHFCQUFnQixHQUFHLGtCQUFrQixDQUFDO1FBUXRDLG9CQUFlLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7SUF5QnRELENBQUM7SUF2QkosSUFBSSxXQUFXOztRQUNiLE1BQU0sTUFBTSxTQUFHLElBQUksQ0FBQyxXQUFXLDBDQUFFLE1BQU0sQ0FBQztRQUN4QyxJQUFJLE1BQU0sYUFBTixNQUFNLHVCQUFOLE1BQU0sQ0FBRSxXQUFXLEVBQUU7WUFDdkIsT0FBTyxNQUFNLENBQUMsV0FBVyxDQUFDO1NBQzNCO2FBQU0sSUFBSSxDQUFBLE1BQU0sYUFBTixNQUFNLHVCQUFOLE1BQU0sQ0FBRSxTQUFTLEtBQUksTUFBTSxDQUFDLFFBQVEsRUFBRTtZQUMvQyxPQUFPLE1BQU0sQ0FBQyxTQUFTLEdBQUcsR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7U0FDakQ7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUM7U0FDOUM7SUFDSCxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxDQUFDLE9BQU8sQ0FBQztJQUNwRCxDQUFDO0lBRUQsSUFBSSxRQUFRO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDOUMsQ0FBQztJQVFELFFBQVE7UUFDTixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEQsSUFBSSxDQUFDLFdBQVc7YUFDYixTQUFTLEVBQUU7YUFDWCxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsT0FBTyxDQUFDLEtBQUs7UUFDWCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVELE1BQU0sQ0FBQyxLQUFZO1FBQ2pCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7OztZQWpGRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsdzlFQUE0QztnQkFFNUMsVUFBVSxFQUFFO29CQUNWLE9BQU8sQ0FBQyxNQUFNLEVBQUU7d0JBQ2QsS0FBSyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQzs0QkFDNUIsTUFBTSxFQUFFLEtBQUs7NEJBQ2IsYUFBYSxFQUFFLEtBQUs7NEJBQ3BCLFFBQVEsRUFBRSxRQUFRO3lCQUNuQixDQUFDLENBQUM7d0JBQ0gsS0FBSyxDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQzs0QkFDN0IsTUFBTSxFQUFFLEdBQUc7NEJBQ1gsUUFBUSxFQUFFLFNBQVM7eUJBQ3BCLENBQUMsQ0FBQzt3QkFDSCxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQzs0QkFDckIsT0FBTyxFQUFFLENBQUM7NEJBQ1YsU0FBUyxFQUFFLEdBQUc7eUJBQ2YsQ0FBQyxDQUFDO3dCQUNILEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDOzRCQUNwQixPQUFPLEVBQUUsQ0FBQzs0QkFDVixTQUFTLEVBQUUsR0FBRzt5QkFDZixDQUFDLENBQUM7d0JBQ0gsVUFBVSxDQUFDLG1DQUFtQyxFQUFFLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3dCQUNoRyxVQUFVLENBQUMsbUNBQW1DLEVBQUUsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7d0JBQ2hHLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRSxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7d0JBQ3RELFVBQVUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUM7cUJBQ2pILENBQUM7aUJBQ0g7O2FBQ0Y7Ozs0Q0FnQ0ksTUFBTSxTQUFDLFlBQVk7WUFoRWYsTUFBTTtZQUNOLG9CQUFvQjs7OytCQXFDMUIsS0FBSzs4QkFHTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5qZWN0LCBJbnB1dCwgT25Jbml0LCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgYW5pbWF0ZSxcbiAgc3RhdGUsXG4gIHN0eWxlLFxuICB0cmFuc2l0aW9uLFxuICB0cmlnZ2VyXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgQVVUSF9TRVJWSUNFIH0gZnJvbSAnLi4vLi4vYXBpL2luamVjdGlvbi10b2tlbnMnO1xuaW1wb3J0IHsgSUF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYXBpL2lhdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclByb2ZpbGUgfSBmcm9tICcuLi8uLi9hcGkvbW9kZWwvdXNlci1wcm9maWxlLm1vZGVsJztcbmltcG9ydCB7IERFRkFVTFRfQVZBVEFSX1VSTCB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBBdmF0YXJJbmZvIH0gZnJvbSAnLi4vLi4vYXBpL21vZGVsL2F2YXRhci1pbmZvLm1vZGVsJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL2FwaS9jb25maWd1cmF0aW9uLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0ay1pbmxpbmUtcHJvZmlsZScsXG4gIHRlbXBsYXRlVXJsOiAnaW5saW5lLXByb2ZpbGUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9pbmxpbmUtcHJvZmlsZS5jb21wb25lbnQuc2NzcyddLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignbWVudScsIFtcbiAgICAgIHN0YXRlKCdoaWRkZW5BbmltYXRlZCcsIHN0eWxlKHtcbiAgICAgICAgaGVpZ2h0OiAnMHB4JyxcbiAgICAgICAgcGFkZGluZ0JvdHRvbTogJzBweCcsXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ3Zpc2libGVBbmltYXRlZCcsIHN0eWxlKHtcbiAgICAgICAgaGVpZ2h0OiAnKicsXG4gICAgICAgIG92ZXJmbG93OiAndmlzaWJsZSdcbiAgICAgIH0pKSxcbiAgICAgIHN0YXRlKCd2aXNpYmxlJywgc3R5bGUoe1xuICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAnei1pbmRleCc6IDEwMFxuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ2hpZGRlbicsIHN0eWxlKHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgJ3otaW5kZXgnOiAnKidcbiAgICAgIH0pKSxcbiAgICAgIHRyYW5zaXRpb24oJ3Zpc2libGVBbmltYXRlZCA9PiBoaWRkZW5BbmltYXRlZCcsIGFuaW1hdGUoJzQwMG1zIGN1YmljLWJlemllcigwLjg2LCAwLCAwLjA3LCAxKScpKSxcbiAgICAgIHRyYW5zaXRpb24oJ2hpZGRlbkFuaW1hdGVkID0+IHZpc2libGVBbmltYXRlZCcsIGFuaW1hdGUoJzQwMG1zIGN1YmljLWJlemllcigwLjg2LCAwLCAwLjA3LCAxKScpKSxcbiAgICAgIHRyYW5zaXRpb24oJ3Zpc2libGUgPT4gaGlkZGVuJywgYW5pbWF0ZSgnLjFzIGxpbmVhcicpKSxcbiAgICAgIHRyYW5zaXRpb24oJ2hpZGRlbiA9PiB2aXNpYmxlJywgW3N0eWxlKHt0cmFuc2Zvcm06ICdzY2FsZVkoMC44KSd9KSwgYW5pbWF0ZSgnLjEycyBjdWJpYy1iZXppZXIoMCwgMCwgMC4yLCAxKScpXSlcbiAgICBdKVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIEFwcElubGluZVByb2ZpbGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBkZWZhdWx0QXZhdGFyVXJsID0gREVGQVVMVF9BVkFUQVJfVVJMO1xuICB1c2VyUHJvZmlsZTogVXNlclByb2ZpbGU7XG4gIHVzZXJBdmF0YXI6IEF2YXRhckluZm87XG5cbiAgQElucHV0KClcbiAgaW5saW5lTWVudUFjdGl2ZTogYm9vbGVhblxuXG4gIEBPdXRwdXQoKVxuICBpbmxpbmVNZW51Q2xpY2s6IEV2ZW50RW1pdHRlcjxudWxsPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBnZXQgZGlzcGxheU5hbWUoKSB7XG4gICAgY29uc3QgcGVyc29uID0gdGhpcy51c2VyUHJvZmlsZT8ucGVyc29uO1xuICAgIGlmIChwZXJzb24/LmRpc3BsYXlOYW1lKSB7XG4gICAgICByZXR1cm4gcGVyc29uLmRpc3BsYXlOYW1lO1xuICAgIH0gZWxzZSBpZiAocGVyc29uPy5maXJzdE5hbWUgJiYgcGVyc29uLmxhc3ROYW1lKSB7XG4gICAgICByZXR1cm4gcGVyc29uLmZpcnN0TmFtZSArICcgJyArIHBlcnNvbi5sYXN0TmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuYXV0aFNlcnZpY2UuY3VycmVudFVzZXIoKS51c2VySWQ7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGJhc2VVcmwoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnU2VydmljZS5nZXRQb3J0YWxEYXRhKCkuYmFzZVVybDtcbiAgfVxuXG4gIGdldCB0YWJJbmRleCgpIHtcbiAgICByZXR1cm4gIXRoaXMuaW5saW5lTWVudUFjdGl2ZSA/ICctMScgOiBudWxsO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChBVVRIX1NFUlZJQ0UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IElBdXRoU2VydmljZSxcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgY29uZmlnU2VydmljZTogQ29uZmlndXJhdGlvblNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudXNlclByb2ZpbGUgPSB0aGlzLmF1dGhTZXJ2aWNlLmN1cnJlbnRVc2VyKCk7XG4gICAgdGhpcy5hdXRoU2VydmljZVxuICAgICAgLmdldEF2YXRhcigpXG4gICAgICAuc3Vic2NyaWJlKGF2YXRhciA9PiAodGhpcy51c2VyQXZhdGFyID0gYXZhdGFyKSk7XG4gIH1cblxuICBvbkNsaWNrKGV2ZW50KSB7XG4gICAgdGhpcy5pbmxpbmVNZW51Q2xpY2suZW1pdChudWxsKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgbG9nb3V0KGV2ZW50OiBFdmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5hdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgfVxufVxuIl19