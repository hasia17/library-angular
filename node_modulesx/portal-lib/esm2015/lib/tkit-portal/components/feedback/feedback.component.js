import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
export class FeedbackComponent {
    constructor(fb) {
        this.fb = fb;
        this.minLength = 5;
        this.submitDisabled = false;
        this.feedbackDataChange = new EventEmitter();
        this.feedbackSubmit = new EventEmitter();
        this.commentRequired = false;
        this.requiredCommentValidator = (fg) => {
            const rating = fg.controls.rating.value;
            const comment = fg.controls.comment.value;
            if (rating > 0 && rating < 5) {
                this.commentRequired = true;
                return comment.length >= this.minLength ? null : { missingComment: true };
            }
            else {
                this.commentRequired = false;
                return null;
            }
        };
    }
    set feedbackData(feedback) {
        if (this.form) {
            this.form.patchValue(feedback);
        }
    }
    ngOnInit() {
        this.form = this.fb.group({
            rating: [0, [Validators.required, Validators.min(1), Validators.max(5)]],
            comment: ['', Validators.minLength(this.minLength)],
            anonymous: false
        }, { validators: this.requiredCommentValidator });
        this.form.valueChanges.subscribe(values => {
            this.feedbackDataChange.emit(values);
        });
    }
    submitFeedback() {
        if (this.form.valid && !this.submitDisabled) {
            this.submitDisabled = true;
            this.feedbackSubmit.emit(this.form.value);
        }
    }
}
FeedbackComponent.decorators = [
    { type: Component, args: [{
                selector: 'tk-feedback',
                template: "<form [formGroup]=\"form\">\n  <div class=\"feedback\">\n    <div>Rate app</div>\n    <div class=\"rating\">\n      <p-rating [cancel]=\"false\" formControlName=\"rating\"></p-rating>\n    </div>\n    <div>Comments {{ commentRequired ? \"(required)\" : \"(optional)\" }}</div>\n    <div>\n      <textarea\n        class=\"fill\"\n        pInputTextarea\n        rows=\"5\"\n        placeholder=\"Min. {{ minLength }} characters\"\n        formControlName=\"comment\"\n      ></textarea>\n    </div>\n    <div class=\"anon\">\n      <p-checkbox\n        name=\"anon\"\n        value=\"Anonymous\"\n        label=\"Anonymous\"\n        formControlName=\"anonymous\"\n      ></p-checkbox>\n    </div>\n    <div class=\"submit\">\n      <button\n        pButton\n        [disabled]=\"form.invalid || submitDisabled\"\n        label=\"Submit\"\n        (click)=\"submitFeedback()\"\n      ></button>\n    </div>\n  </div>\n</form>\n",
                styles: [".feedback .fill{width:15rem;background-color:#efefef}.feedback .rating{text-align:center}.feedback .anon{padding:.5rem 0}.feedback .submit{padding:.5em 0}.feedback .submit button{width:100%}"]
            },] }
];
FeedbackComponent.ctorParameters = () => [
    { type: FormBuilder }
];
FeedbackComponent.propDecorators = {
    submitDisabled: [{ type: Input }],
    feedbackData: [{ type: Input }],
    feedbackDataChange: [{ type: Output }],
    feedbackSubmit: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVlZGJhY2suY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9ydGFsLWxpYi9zcmMvbGliL3RraXQtcG9ydGFsL2NvbXBvbmVudHMvZmVlZGJhY2svZmVlZGJhY2suY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUNMLFdBQVcsRUFHWCxVQUFVLEVBQ1gsTUFBTSxnQkFBZ0IsQ0FBQztBQVF4QixNQUFNLE9BQU8saUJBQWlCO0lBK0I1QixZQUFvQixFQUFlO1FBQWYsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQTdCbkMsY0FBUyxHQUFHLENBQUMsQ0FBQztRQUdkLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBU3ZCLHVCQUFrQixHQUFnQyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXJFLG1CQUFjLEdBQWdDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakUsb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFFeEIsNkJBQXdCLEdBQWdCLENBQUMsRUFBYSxFQUFFLEVBQUU7WUFDeEQsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ3hDLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUMxQyxJQUFJLE1BQU0sR0FBRyxDQUFDLElBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7Z0JBQzVCLE9BQU8sT0FBTyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDO2FBQzNFO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO2dCQUM3QixPQUFPLElBQUksQ0FBQzthQUNiO1FBQ0gsQ0FBQyxDQUFDO0lBRW9DLENBQUM7SUF6QnZDLElBQ0ksWUFBWSxDQUFDLFFBQXVCO1FBQ3RDLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ2hDO0lBQ0gsQ0FBQztJQXNCRCxRQUFRO1FBQ04sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztZQUN4QixNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNuRCxTQUFTLEVBQUUsS0FBSztTQUNqQixFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQzNDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1lBQzNCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDM0M7SUFDSCxDQUFDOzs7WUF0REYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxhQUFhO2dCQUN2QiwyNkJBQXdDOzthQUV6Qzs7O1lBWEMsV0FBVzs7OzZCQWdCVixLQUFLOzJCQUVMLEtBQUs7aUNBT0wsTUFBTTs2QkFFTixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgRm9ybUJ1aWxkZXIsXG4gIEZvcm1Hcm91cCxcbiAgVmFsaWRhdG9yRm4sXG4gIFZhbGlkYXRvcnNcbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRmVlZGJhY2tCYXNpYyB9IGZyb20gJy4uLy4uLy4uL2FwaS9tb2RlbC9mZWVkYmFjay5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RrLWZlZWRiYWNrJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2ZlZWRiYWNrLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZmVlZGJhY2suY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBGZWVkYmFja0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIGZvcm06IEZvcm1Hcm91cDtcbiAgbWluTGVuZ3RoID0gNTtcblxuICBASW5wdXQoKVxuICBzdWJtaXREaXNhYmxlZCA9IGZhbHNlO1xuICBASW5wdXQoKVxuICBzZXQgZmVlZGJhY2tEYXRhKGZlZWRiYWNrOiBGZWVkYmFja0Jhc2ljKSB7XG4gICAgaWYgKHRoaXMuZm9ybSkge1xuICAgICAgdGhpcy5mb3JtLnBhdGNoVmFsdWUoZmVlZGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIEBPdXRwdXQoKVxuICBmZWVkYmFja0RhdGFDaGFuZ2U6IEV2ZW50RW1pdHRlcjxGZWVkYmFja0Jhc2ljPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpXG4gIGZlZWRiYWNrU3VibWl0OiBFdmVudEVtaXR0ZXI8RmVlZGJhY2tCYXNpYz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIGNvbW1lbnRSZXF1aXJlZCA9IGZhbHNlO1xuXG4gIHJlcXVpcmVkQ29tbWVudFZhbGlkYXRvcjogVmFsaWRhdG9yRm4gPSAoZmc6IEZvcm1Hcm91cCkgPT4ge1xuICAgIGNvbnN0IHJhdGluZyA9IGZnLmNvbnRyb2xzLnJhdGluZy52YWx1ZTtcbiAgICBjb25zdCBjb21tZW50ID0gZmcuY29udHJvbHMuY29tbWVudC52YWx1ZTtcbiAgICBpZiAocmF0aW5nID4gMCAmJiByYXRpbmcgPCA1KSB7XG4gICAgICB0aGlzLmNvbW1lbnRSZXF1aXJlZCA9IHRydWU7XG4gICAgICByZXR1cm4gY29tbWVudC5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyBudWxsIDogeyBtaXNzaW5nQ29tbWVudDogdHJ1ZSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbW1lbnRSZXF1aXJlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyKSB7fVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgcmF0aW5nOiBbMCwgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluKDEpLCBWYWxpZGF0b3JzLm1heCg1KV1dLFxuICAgICAgY29tbWVudDogWycnLCBWYWxpZGF0b3JzLm1pbkxlbmd0aCh0aGlzLm1pbkxlbmd0aCldLFxuICAgICAgYW5vbnltb3VzOiBmYWxzZVxuICAgIH0sIHsgdmFsaWRhdG9yczogdGhpcy5yZXF1aXJlZENvbW1lbnRWYWxpZGF0b3IgfSk7XG4gICAgdGhpcy5mb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWVzID0+IHtcbiAgICAgIHRoaXMuZmVlZGJhY2tEYXRhQ2hhbmdlLmVtaXQodmFsdWVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN1Ym1pdEZlZWRiYWNrKCkge1xuICAgIGlmICh0aGlzLmZvcm0udmFsaWQgJiYgIXRoaXMuc3VibWl0RGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuc3VibWl0RGlzYWJsZWQgPSB0cnVlO1xuICAgICAgdGhpcy5mZWVkYmFja1N1Ym1pdC5lbWl0KHRoaXMuZm9ybS52YWx1ZSk7XG4gICAgfVxuICB9XG59XG4iXX0=