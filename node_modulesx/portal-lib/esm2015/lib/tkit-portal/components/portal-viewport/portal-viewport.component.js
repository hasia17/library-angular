import { Component, ViewChild, Renderer2, NgZone, Input, Inject, } from '@angular/core';
import { NavigationStart, NavigationEnd, NavigationError, Router, ActivatedRoute, ActivationEnd, } from '@angular/router';
import { HelpPageAPIService } from '../../../api/services/help-page-api.service';
import { MessageService, PrimeNGConfig } from 'primeng/api';
import { DialogService } from 'primeng/dynamicdialog';
import { NoHelpInfoComponent } from '../no-help-info/no-help-info.component';
import { isTkitPage } from '../../pages/PortalPage';
import { TranslateService } from '@ngx-translate/core';
import { ConfigurationService } from '../../../api/configuration.service';
import { ThemeService } from '../../../api/services/theme.service';
import { MenuApiService } from '../../../api/services/menu-api.service';
import { AUTH_SERVICE } from '../../../api/injection-tokens';
import { CONFIG_KEY_TKIT_PORTAL_DISABLE_THEME_MANAGEMENT } from '../../constants';
import { BreakpointObserver } from '@angular/cdk/layout';
import { FeedbackApiService } from '../../../api/services/feedback-api.service';
import { SupportTicketApiService } from '../../../api/services/support-ticket-api.service';
import { MenuService } from "../../../api/services/menu.service";
var MenuOrientation;
(function (MenuOrientation) {
    MenuOrientation[MenuOrientation["STATIC"] = 0] = "STATIC";
    MenuOrientation[MenuOrientation["OVERLAY"] = 1] = "OVERLAY";
    MenuOrientation[MenuOrientation["SLIM"] = 2] = "SLIM";
    MenuOrientation[MenuOrientation["HORIZONTAL"] = 3] = "HORIZONTAL";
})(MenuOrientation || (MenuOrientation = {}));
const FALLBACK_THEME_URL = './portal-lib/assets/css/fallback-theme/fallback.css';
const DEFAULT_BASE_URL = 'https://1000kit.atlassian.net/wiki/spaces/1000KIT/overview';
export class PortalViewportComponent {
    constructor(renderer2, zone, router, route, helpDataService, messageService, dialogService, breakpointObserver, translate, themeService, menuService, menuApiService, configService, feedbackApiService, supportTicketApiService, primeNgConfig, auth) {
        this.renderer2 = renderer2;
        this.zone = zone;
        this.router = router;
        this.route = route;
        this.helpDataService = helpDataService;
        this.messageService = messageService;
        this.dialogService = dialogService;
        this.breakpointObserver = breakpointObserver;
        this.translate = translate;
        this.themeService = themeService;
        this.menuService = menuService;
        this.menuApiService = menuApiService;
        this.configService = configService;
        this.feedbackApiService = feedbackApiService;
        this.supportTicketApiService = supportTicketApiService;
        this.primeNgConfig = primeNgConfig;
        this.auth = auth;
        this.showProfileInSidebar = true;
        this.enableBreadcrumbs = false;
        this.fullPortalLayout = true;
        // TKIT
        this.helpPageEditorDisplayed = false;
        this.addToFavouritesDisplayed = false;
        this.supportTicketDisplayed = false;
        this.feedbackData = { comment: '', rating: 0, anonymous: false };
        this.feedbackVisible = false;
        this.feedbackSubmitDisabled = false;
        this.portalName = 'PORTAL';
        // PRIMENG STUFF
        this.layoutMode = MenuOrientation.STATIC;
        // TODO Ultima11: dark menu
        this.darkMenu = false;
        this.profileMode = 'top';
        this.searchClick = false;
        this.search = false;
        this.preloader = true;
        this.portalHomeMenuItem = { url: '/', label: 'Home' };
    }
    get menuButtonTitle() {
        return (this.isDesktop() && this.menuActive || this.isMobile() && this.mobileMenuActive) ? this.hideMenuButtonTitle : this.showMenuButtonTitle;
    }
    applyPadding() {
        if (this.isBodyCompact) {
            this.addClass(document.body, 'compact');
        }
        else {
            this.removeClass(document.body, 'compact');
        }
    }
    setSidebarColorTheme() {
        if (this.sideBarColorTheme === 'DARK') {
            this.darkMenu = true;
        }
        else if (this.sideBarColorTheme === 'LIGHT') {
            this.darkMenu = false;
        }
    }
    ngOnInit() {
        var _a;
        this.primeNgConfig.ripple = true;
        this.initError = this.configService.error;
        if (this.initError) {
            this.preloader = false;
            return;
        }
        this.mainPortal = this.configService.getPortalData();
        if (this.auth.currentUser().accountSettings.layoutAndThemeSettings) {
            this.isBodyCompact = (_a = this.auth.currentUser().accountSettings.layoutAndThemeSettings.compactView) !== null && _a !== void 0 ? _a : false;
            this.applyPadding();
            // this.sideBarColorTheme = this.auth.currentUser().accountSettings.layoutAndThemeSettings.menuTheme ?? 'LIGHT'
            if (this.auth.currentUser().accountSettings.layoutAndThemeSettings.sidebarViewMode) {
                this.layoutMode =
                    MenuOrientation[this.auth.currentUser().accountSettings.layoutAndThemeSettings.sidebarViewMode];
            }
            else {
                this.layoutMode = MenuOrientation['STATIC'];
            }
        }
        this.menuActive = this.isStatic() && !this.isMobile() && this.fullPortalLayout;
        this.validateRequiredInputs();
        this.setSidebarColorTheme();
        this.setCustomTheme();
        if (this.fullPortalLayout) {
            this.loadMenuItems();
        }
        this.router.events.subscribe((event) => {
            // console.log(`nav event ${event.constructor.name}`);
            if (event instanceof NavigationStart) {
                // Show loading indicator
            }
            if (event instanceof ActivationEnd) {
                // this.helpArticleId = event.snapshot.pathFromRoot
                //   .map(i => (i.routeConfig ? i.routeConfig.path : ''))
                //   .join('/');
                // console.log(`aftger event ${this.helpArticleId}`);
            }
            if (event instanceof NavigationEnd && this.fullPortalLayout) {
                // Hide loading indicator
                if (this.currentComponent) {
                    let helpPageIdentifier;
                    if (isTkitPage(this.currentComponent)) {
                        helpPageIdentifier = this.currentComponent.helpArticleId;
                    }
                    else {
                        helpPageIdentifier = event.url || this.currentComponent.constructor.name;
                        console.log(`Page does not have helpItemId, using router path ${helpPageIdentifier}`);
                    }
                    this.helpArticleId = helpPageIdentifier;
                    this.helpDataItem = {
                        helpItemId: helpPageIdentifier,
                        appId: this.appName,
                        baseUrl: DEFAULT_BASE_URL,
                        resourceUrl: '',
                    };
                    this.loadHelpArticle();
                }
            }
            if (event instanceof NavigationError) {
                // Hide loading indicator
                // Present error to user
                this.messageService.add({
                    severity: 'error',
                    summary: 'Navigation error',
                    detail: `Route ${event.url} not recognized`,
                });
            }
            // console.log(`navigate event ${event}`);
            this.setSidebarColorTheme();
        });
        this.translate.get(['GENERAL.SHOW_MENU', 'GENERAL.HIDE_MENU']).subscribe(text => {
            this.hideMenuButtonTitle = text['GENERAL.HIDE_MENU'];
            this.showMenuButtonTitle = text['GENERAL.SHOW_MENU'];
        });
    }
    ngAfterViewInit() {
        this.documentClickListener = this.renderer2.listen('body', 'click', () => {
            if (!this.topbarItemClick) {
                this.activeTopbarItem = null;
            }
            if (!this.menuClick && (this.isHorizontal() || this.isSlim())) {
                this.menuService.reset();
            }
            if (!this.menuClick) {
                if (this.mobileMenuActive) {
                    this.mobileMenuActive = false;
                }
                if (this.isOverlay()) {
                    this.menuActive = false;
                }
                this.menuHoverActive = false;
                this.unblockBodyScroll();
            }
            if (!this.searchClick) {
                this.search = false;
            }
            if (this.inlineMenuActive && !this.inlineMenuClick) {
                this.inlineMenuActive = false;
            }
            this.inlineMenuClick = false;
            this.searchClick = false;
            this.topbarItemClick = false;
            this.menuClick = false;
        });
    }
    loadMenuItems() {
        const portalId = this.configService.getProperty('TKIT_PORTAL_ID');
        const stripForbiddenStr = this.configService.getProperty('TKIT_PORTAL_DISABLE_MENU_PERMISSIONS');
        const stripForbidden = stripForbiddenStr === 'true';
        this.configService.lang$.subscribe(data => (this.lang = data)).unsubscribe();
        if (!portalId) {
            this.portalMenuItems = [{ label: 'Failed to load menu', icon: 'dashboard', routerLink: ['/'] }];
        }
        else if (this.fullPortalLayout) {
            this.menuApiService.getMenuItems(portalId).subscribe(data => {
                let serverMenuItems = [];
                const mainMenuItem = data.find(item => item.key === 'PORTAL_MAIN_MENU');
                this.portalHomeMenuItem = this.toPrimeNGMenuItem(data.find(item => item.key === 'PORTAL_MENU_HOME'));
                if (!this.portalHomeMenuItem) {
                    this.portalHomeMenuItem = { url: '/', label: 'Home' };
                }
                if (mainMenuItem) {
                    serverMenuItems = mainMenuItem.children
                        .filter(item => (!stripForbidden || this.auth.hasPermission(`${item.permissionObject}#VIEW`)) && !item.disabled)
                        .sort((a, b) => a.position - b.position)
                        .map(item => this.toPrimeNGMenuItem(item));
                }
                this.portalMenuItems = [
                    // { label: 'Portal Home', icon: 'dashboard', routerLink: ['/'] },
                    ...serverMenuItems,
                ];
            });
        }
    }
    toPrimeNGMenuItem(item, level = 1) {
        if (!item) {
            return undefined;
        }
        let isAbsoluteLink = item.url && item.url.match(/^(http|https)/g) !== null;
        const currentHost = document.getElementsByTagName('base')[0].href;
        let routerLink = undefined;
        const label = item.i18n[this.lang] || item.name;
        if (this.appName === item.applicationId) {
            // it is a local link, set routerlink
            if (isAbsoluteLink && item.url.includes(currentHost)) {
                routerLink = [item.url.substr(currentHost.length - 1)];
                isAbsoluteLink = false;
            }
            else {
                const path = currentHost.substring(window.location.origin.length);
                if (path.length >= 1 && item.url.startsWith(path)) {
                    // its a link within same  path
                    routerLink = [item.url.substr(path.length - 1)];
                    isAbsoluteLink = false;
                }
            }
        }
        let badgeIcon = level === 1 ? 'menu' : 'subject';
        if (item.badge !== '' && item.badge) {
            badgeIcon = item.badge;
        }
        return {
            label,
            // badge: '🔗',
            icon: badgeIcon,
            command: e => {
                e.originalEvent.preventDefault();
                if (item.children.length === 0) {
                    item.portalExit
                        ? window.open(item.url, '_blank')
                        : routerLink
                            ? this.router.navigate(routerLink)
                            : window.location.assign(item.url);
                }
            },
            url: item.url,
            routerLinkActiveOptions: [{ exact: false }],
            items: item.children.length > 0
                ? item.children
                    .filter(child => !child.disabled)
                    .sort((a, b) => a.position - b.position)
                    .map(child => this.toPrimeNGMenuItem(child, level + 1))
                : undefined,
        };
    }
    validateRequiredInputs() {
        if (!this.appName) {
            throw new Error(`You must specify [appName] attribute on <tk-portal-viewport> component.`);
        }
    }
    loadHelpArticle() {
        this.helpDataService.getHelpDataItem(this.appName, this.helpArticleId).subscribe(data => {
            if (data) {
                this.helpDataItem = data;
            }
        }, error => console.log('Failed to load help article'));
    }
    onHelpArticleEditorClosed(changed) {
        if (changed) {
            this.helpDataService.saveHelpPage(this.appName, this.helpDataItem).subscribe(res => {
                console.log(`Help item saved: ${res.status}`);
                this.helpPageEditorDisplayed = false;
                this.messageService.add({
                    severity: 'info',
                    summary: 'Help Item definition updated',
                });
                this.loadHelpArticle();
            }, error => {
                console.log(`Could not save help item`);
                this.messageService.add({
                    severity: 'error',
                    summary: 'Help Item definition update failed',
                    detail: `Server error: ${error.status}`,
                });
            });
        }
        else {
            this.helpPageEditorDisplayed = false;
        }
    }
    onAddToLaunchpadClosed(event) {
        this.addToFavouritesDisplayed = false;
    }
    openHelpPage(event) {
        if (this.helpDataItem.id) {
            const url = this.helpDataItem.baseUrl
                ? `${this.helpDataItem.baseUrl}/${this.helpDataItem.resourceUrl}`
                : this.helpDataItem.resourceUrl;
            console.log(`navigate to help page: ${url}`);
            const win = window.open(url, '_blank');
            win.focus();
        }
        else {
            this.dialogService.open(NoHelpInfoComponent, {
                header: 'No help item defined for this page',
                width: '400px',
                data: {
                    pageItem: this.helpArticleId,
                },
            });
        }
        event.preventDefault();
    }
    openHelpPageEditor(event) {
        this.helpPageEditorDisplayed = true;
        event.preventDefault();
    }
    openFeedback(event) {
        if (this.breakpointObserver.isMatched('(max-width: 1024px)')) {
            this.feedbackVisible = true;
        }
        else {
            this.feedbackPanel.toggle(event);
        }
        event.preventDefault();
    }
    openAddToLaunchpad(event) {
        this.addToFavouritesDisplayed = true;
        event.preventDefault();
    }
    openSupportTicket(event) {
        this.supportTicketDisplayed = true;
        event.preventDefault();
    }
    onSubmitFeedback(feedback) {
        this.feedbackSubmitDisabled = true;
        const feedbackDTO = {
            rating: feedback.rating,
            comment: feedback.comment,
            appId: this.appName,
            userId: feedback.anonymous ? 'anonymous' : this.auth.currentUser().userId,
        };
        this.feedbackApiService.sendFeedback(feedbackDTO).subscribe(() => {
            this.closeFeedback();
            this.messageService.add({
                severity: 'success',
                summary: 'Feedback successfully sent',
            });
        }, () => {
            this.closeFeedback();
            this.messageService.add({
                severity: 'error',
                summary: 'Sending feedback failed',
                detail: 'Please try again later',
            });
        });
    }
    closeFeedback() {
        this.feedbackSubmitDisabled = false;
        this.feedbackVisible = false;
        this.feedbackPanel.hide();
    }
    onSubmitTicket(ticket) {
        this.supportTicketApiService.createSupportTicket(ticket, this.appName).subscribe(() => {
            this.messageService.add({
                severity: 'success',
                summary: 'Success!',
                detail: 'Ticket successfully submitted',
            });
        }, () => this.messageService.add({
            severity: 'error',
            summary: 'Error!',
            detail: 'Error occured while submitting a ticket',
        }));
    }
    clearFeedback() {
        this.feedbackData = { comment: '', rating: 0, anonymous: false };
    }
    addClass(element, className) {
        if (element.classList) {
            element.classList.add(className);
        }
        else {
            element.className += ' ' + className;
        }
    }
    removeClass(element, className) {
        if (element.classList) {
            element.classList.remove(className);
        }
        else {
            element.className = element.className.replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
        }
    }
    onMenuButtonClick(event) {
        this.menuActive = !this.menuActive;
        this.menuClick = true;
        if (!this.isDesktop()) {
            this.mobileMenuActive = !this.mobileMenuActive;
            if (this.mobileMenuActive) {
                this.blockBodyScroll();
            }
            else {
                this.unblockBodyScroll();
            }
        }
        event.preventDefault();
    }
    onMenuClick($event) {
        this.menuClick = true;
        if (this.inlineMenuActive && !this.inlineMenuClick) {
            this.inlineMenuActive = false;
        }
    }
    onInlineMenuClick(event) {
        this.inlineMenuActive = !this.inlineMenuActive;
        this.inlineMenuClick = true;
    }
    onTopbarMobileButtonClick(event) {
        this.mobileTopbarActive = !this.mobileTopbarActive;
        event.preventDefault();
    }
    onTopbarItemClick(event, item) {
        this.topbarItemClick = true;
        if (this.activeTopbarItem === item) {
            this.activeTopbarItem = null;
        }
        else {
            this.activeTopbarItem = item;
        }
        if (item === 'search') {
            this.search = !this.search;
            this.searchClick = !this.searchClick;
        }
        event.preventDefault();
    }
    onSearchClick(event, val) {
        this.searchClick = val;
        this.search = val;
        event.preventDefault();
    }
    isDesktop() {
        return window.innerWidth > 991;
    }
    isMobile() {
        return window.innerWidth <= 991;
    }
    isStatic() {
        return this.layoutMode === MenuOrientation.STATIC;
    }
    isOverlay() {
        return this.layoutMode === MenuOrientation.OVERLAY;
    }
    isHorizontal() {
        return this.layoutMode === MenuOrientation.HORIZONTAL;
    }
    isSlim() {
        return this.layoutMode === MenuOrientation.SLIM;
    }
    changeToStaticMenu() {
        this.layoutMode = MenuOrientation.STATIC;
    }
    changeToOverlayMenu() {
        this.layoutMode = MenuOrientation.OVERLAY;
    }
    changeToHorizontalMenu() {
        this.layoutMode = MenuOrientation.HORIZONTAL;
    }
    changeToSlimMenu() {
        this.layoutMode = MenuOrientation.SLIM;
    }
    blockBodyScroll() {
        if (document.body.classList) {
            document.body.classList.add('blocked-scroll');
        }
        else {
            document.body.className += ' blocked-scroll';
        }
    }
    unblockBodyScroll() {
        if (document.body.classList) {
            document.body.classList.remove('blocked-scroll');
        }
        else {
            document.body.className = document.body.className.replace(new RegExp('(^|\\b)' +
                'blocked-scroll'.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
        }
    }
    setCustomTheme() {
        const disablePortalThemeMgmt = this.configService.getProperty(CONFIG_KEY_TKIT_PORTAL_DISABLE_THEME_MANAGEMENT) === 'true';
        if (disablePortalThemeMgmt) {
            console.log(`Portal theme mgmt is disabled. To enable it, remove env var: ${CONFIG_KEY_TKIT_PORTAL_DISABLE_THEME_MANAGEMENT}`);
            this.preloader = false;
            return;
        }
        console.log(`Setting theme dynamically`);
        let customTheme = this.configService.getPortalData() && this.configService.getPortalData().themeName;
        if (!customTheme) {
            const themeFromEnv = this.configService.getProperty('TKIT_PORTAL_DEFAULT_THEME');
            if (!themeFromEnv) {
                console.log(`Custom theme not defined, or portal data not available, setting default theme CG`);
                customTheme = 'cg';
            }
            else {
                console.log(`Custom theme not defined, or portal data not available, setting theme from 'TKIT_PORTAL_DEFAULT_THEME' var: ${themeFromEnv} `);
                customTheme = themeFromEnv;
            }
        }
        if (document.getElementById('theme-css')) {
            const themeLinkToRemove = document.getElementById('theme-css');
            themeLinkToRemove.remove();
        }
        const themeLink = document.createElement('link');
        themeLink.setAttribute('id', 'theme-css');
        themeLink.setAttribute('rel', 'stylesheet');
        themeLink.setAttribute('type', 'text/css');
        themeLink.onload = () => {
            console.log('theme load done');
            this.preloader = false;
        };
        themeLink.onerror = () => {
            console.log(`Failed to load theme assets for '${customTheme}'`);
            themeLink.setAttribute('href', FALLBACK_THEME_URL);
            this.preloader = false;
        };
        themeLink.setAttribute('href', this.themeService.getThemeHref(customTheme));
        document.getElementsByTagName('head')[0].appendChild(themeLink);
    }
}
PortalViewportComponent.decorators = [
    { type: Component, args: [{
                selector: 'tk-portal-viewport',
                template: "<div class=\"loading-block\" *ngIf=\"preloader\">\n  <div\n    class=\"p-d-flex p-mb-3 p-p-1\"\n    style=\"position: fixed;\n    z-index: 100;\n    width: 100%;\n    background-color: #fff;\n    height: 75px;\n    box-shadow: 0 2px 5px 0 rgb(0 0 0 / 26%);\n    -webkit-box-shadow: 0 2px 5px 0 rgb(0 0 0 / 26%);\"\n  >\n    <p-skeleton width=\"8rem\" height=\"60px\" styleClass=\"p-mr-2\"></p-skeleton>\n    <div style=\"flex: 1; height: 100%;\">\n      <p-skeleton width=\"100%\" height=\"60px\"></p-skeleton>\n    </div>\n  </div>\n  <div\n    style=\"overflow: auto;\n    position: fixed;\n    margin-left: 0px;\n    width: 250px;\n    z-index: 99;\n    top: 75px;\n    height: 100%;\n    background-color: #fff;\n    box-shadow: 3px 0 6px rgb(0 0 0 / 30%);\n    -webkit-box-shadow: 3px 0 6px rgb(0 0 0 / 30%);\n    -moz-box-shadow: 3px 0 6px rgba(0,0,0,.3);\n    padding: 1rem\"\n  >\n    <div class=\"custom-skeleton p-p-3 p-mt-4\">\n      <div class=\"p-mb-3 p-ml-5\">\n        <p-skeleton shape=\"circle\" size=\"3rem\" styleClass=\"p-mr-2\"></p-skeleton>\n      </div>\n      <p-skeleton width=\"80%\" height=\"1rem\" styleClass=\"p-mb-1 p-ml-2\"></p-skeleton>\n    </div>\n    <div class=\"p-mt-4\">\n      <p-skeleton *ngFor=\"let number of [0,1,2,3,4,5]\" width=\"100%\" height=\"1.5rem\" styleClass=\"p-mb-2\"></p-skeleton>\n    </div>\n  </div>\n</div>\n<div class=\"exception-body error-page\" *ngIf=\"initError\">\n  <div class=\"exception-type\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 48 48\" stroke=\"currentColor\">\n      <path\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        stroke-width=\"2\"\n        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n      />\n    </svg>\n  </div>\n\n  <div class=\"card exception-panel\">\n    <i class=\"pi pi-exclamation-circle\"></i>\n    <h1>Exception Occured</h1>\n    <div class=\"exception-detail\">Please contact system administrator</div>\n\n    <p-button label=\"Homepage\" [routerLink]=\"['/']\" class=\"p-button-help\"></p-button>\n  </div>\n</div>\n\n<div\n  [hidden]=\"preloader || initError\"\n  class=\"layout-wrapper\"\n  [ngClass]=\"{ 'layout-menu-static': isStatic(),\n        'layout-menu-overlay': isOverlay(),\n        'layout-menu-horizontal': isHorizontal(),\n        'layout-menu-slim': isSlim(),\n        'layout-menu-active': menuActive,\n        'layout-menu-mobile-active': mobileMenuActive,\n        'layout-topbar-mobile-active': mobileTopbarActive\n   }\"\n>\n    <tk-header\n      [menuButtonTitle]=\"menuButtonTitle\"\n      [activeTopbarItem]=\"activeTopbarItem\"\n      [isHorizontal]=\"isHorizontal()\"\n      [profileMode]=\"profileMode\"\n      [disableBreadcrumbs]=\"!enableBreadcrumbs\"\n      [homeNavTitle]=\"portalHomeMenuItem.label\"\n      [homeNavUrl]=\"portalHomeMenuItem.url\"\n      [fullPortalLayout]=\"fullPortalLayout\"\n      [search]=\"search\"\n      (searchClick)=\"onSearchClick($event.event, $event.val)\"\n      (menuButtonClick)=\"onMenuButtonClick($event)\"\n      (topbarItemClick)=\"onTopbarItemClick($event.event, $event.arg)\"\n      (openHelpPageEditor)=\"openHelpPageEditor($event)\"\n      (openHelpPage)=\"openHelpPage($event)\"\n      (openFeedback)=\"openFeedback($event)\"\n      (openSupportTicket)=\"openSupportTicket($event)\"\n      (openAddToLaunchpad)=\"openAddToLaunchpad($event)\"\n    ></tk-header>\n\n    <p-overlayPanel #feedbackPanel (onHide)=\"clearFeedback()\">\n      <ng-template pTemplate>\n        <tk-feedback\n          [(feedbackData)]=\"feedbackData\"\n          [submitDisabled]=\"feedbackSubmitDisabled\"\n          (feedbackSubmit)=\"onSubmitFeedback($event)\"\n        >\n        </tk-feedback>\n      </ng-template>\n    </p-overlayPanel>\n\n    <p-dialog header=\"Leave Feedback\" [(visible)]=\"feedbackVisible\" (onHide)=\"clearFeedback()\">\n      <tk-feedback\n        [(feedbackData)]=\"feedbackData\"\n        [submitDisabled]=\"feedbackSubmitDisabled\"\n        (feedbackSubmit)=\"onSubmitFeedback($event)\"\n      >\n      </tk-feedback>\n    </p-dialog>\n\n    <p-toast></p-toast>\n\n    <div class=\"menu-wrapper\" (click)=\"onMenuClick($event)\">\n      <div\n        *ngIf=\"fullPortalLayout\"\n        class=\"layout-menu-container\"\n      >\n        <tk-inline-profile\n          *ngIf=\"showProfileInSidebar && !isHorizontal()\"\n          [inlineMenuActive]=\"inlineMenuActive\"\n          (inlineMenuClick)=\"onInlineMenuClick($event)\"\n        ></tk-inline-profile>\n\n        <tk-menu\n          [(menuActive)]=\"menuActive\"\n          [(mobileMenuActive)]=\"mobileMenuActive\"\n          [isStatic]=\"isStatic()\"\n          [isSlim]=\"isSlim()\"\n          [isHorizontal]=\"isHorizontal()\"\n          [isMobile]=\"isMobile()\"\n          [isDesktop]=\"isDesktop()\"\n          [menuHoverActive]=\"menuHoverActive\"\n          [portalMenu]=\"portalMenuItems\"\n        ></tk-menu>\n      </div>\n    </div>\n\n    <div class=\"layout-main\">\n      <tk-breadcrumb\n        *ngIf=\"enableBreadcrumbs\"\n        [fullPortalLayout]=\"fullPortalLayout\"\n        [disableBreadcrumbs]=\"!enableBreadcrumbs\"\n        (openHelpPageEditor)=\"openHelpPageEditor($event)\"\n        (openHelpPage)=\"openHelpPage($event)\"\n      ></tk-breadcrumb>\n\n      <div class=\"layout-content\">\n        <router-outlet (activate)=\"currentComponent = $event\"></router-outlet>\n        <tk-footer [homePortal]=\"mainPortal\"></tk-footer>\n      </div>\n    </div>\n\n    <div class=\"layout-mask modal-in\"></div>\n</div>\n\n<tk-help-editor\n  *ngIf=\"helpDataItem\"\n  [display]=\"helpPageEditorDisplayed\"\n  [helpItem]=\"helpDataItem\"\n  (closed)=\"onHelpArticleEditorClosed($event)\"\n></tk-help-editor>\n\n<tk-add-to-launchpad\n  *ngIf=\"addToFavouritesDisplayed\"\n  [display]=\"addToFavouritesDisplayed\"\n  (closed)=\"onAddToLaunchpadClosed($event)\"\n  [appId]=\"appName\"\n></tk-add-to-launchpad>\n\n<tk-support-ticket [(display)]=\"supportTicketDisplayed\" (submitTicket)=\"onSubmitTicket($event)\"></tk-support-ticket>\n",
                styles: [`
      .loading-block {
      }
    `]
            },] }
];
PortalViewportComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: NgZone },
    { type: Router },
    { type: ActivatedRoute },
    { type: HelpPageAPIService },
    { type: MessageService },
    { type: DialogService },
    { type: BreakpointObserver },
    { type: TranslateService },
    { type: ThemeService },
    { type: MenuService },
    { type: MenuApiService },
    { type: ConfigurationService },
    { type: FeedbackApiService },
    { type: SupportTicketApiService },
    { type: PrimeNGConfig },
    { type: undefined, decorators: [{ type: Inject, args: [AUTH_SERVICE,] }] }
];
PortalViewportComponent.propDecorators = {
    showProfileInSidebar: [{ type: Input }],
    enableBreadcrumbs: [{ type: Input }],
    fullPortalLayout: [{ type: Input }],
    appName: [{ type: Input }],
    portalName: [{ type: Input }],
    layoutContainerViewChild: [{ type: ViewChild, args: ['layoutContainer',] }],
    layoutMenuScrollerViewChild: [{ type: ViewChild, args: ['scrollPanel',] }],
    feedbackPanel: [{ type: ViewChild, args: ['feedbackPanel',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9ydGFsLXZpZXdwb3J0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BvcnRhbC1saWIvc3JjL2xpYi90a2l0LXBvcnRhbC9jb21wb25lbnRzL3BvcnRhbC12aWV3cG9ydC9wb3J0YWwtdmlld3BvcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBR1QsU0FBUyxFQUVULFNBQVMsRUFDVCxNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQTtBQUV0QixPQUFPLEVBQ0wsZUFBZSxFQUNmLGFBQWEsRUFDYixlQUFlLEVBQ2YsTUFBTSxFQUVOLGNBQWMsRUFDZCxhQUFhLEdBQ2QsTUFBTSxpQkFBaUIsQ0FBQTtBQUN4QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQTtBQUNoRixPQUFPLEVBQUUsY0FBYyxFQUFZLGFBQWEsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUNyRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFFckQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sd0NBQXdDLENBQUE7QUFDNUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFBO0FBQ25ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQ3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFBO0FBQ3pFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQTtBQUNsRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0NBQXdDLENBQUE7QUFDdkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFBO0FBRTVELE9BQU8sRUFBRSwrQ0FBK0MsRUFBRSxNQUFNLGlCQUFpQixDQUFBO0FBR2pG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QUMsQ0FBQyxDQUFBO1FBQzNFLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDakUsQ0FBQzs7O1lBbnFCRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtnQkFDOUIsc2hNQUErQzt5QkFFN0M7OztLQUdDO2FBRUo7OztZQXZEQyxTQUFTO1lBQ1QsTUFBTTtZQVNOLE1BQU07WUFFTixjQUFjO1lBR1Asa0JBQWtCO1lBQ2xCLGNBQWM7WUFDZCxhQUFhO1lBYWIsa0JBQWtCO1lBVGxCLGdCQUFnQjtZQUVoQixZQUFZO1lBWVosV0FBVztZQVhYLGNBQWM7WUFGZCxvQkFBb0I7WUFVcEIsa0JBQWtCO1lBRWxCLHVCQUF1QjtZQWxCRyxhQUFhOzRDQXlKM0MsTUFBTSxTQUFDLFlBQVk7OzttQ0EvR3JCLEtBQUs7Z0NBR0wsS0FBSzsrQkFHTCxLQUFLO3NCQVlMLEtBQUs7eUJBR0wsS0FBSzt1Q0FrREwsU0FBUyxTQUFDLGlCQUFpQjswQ0FHM0IsU0FBUyxTQUFDLGFBQWE7NEJBR3ZCLFNBQVMsU0FBQyxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBBZnRlclZpZXdJbml0LFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgUmVuZGVyZXIyLFxuICBOZ1pvbmUsXG4gIElucHV0LFxuICBJbmplY3QsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXG5pbXBvcnQgeyBTY3JvbGxQYW5lbCB9IGZyb20gJ3ByaW1lbmcvc2Nyb2xscGFuZWwnXG5pbXBvcnQge1xuICBOYXZpZ2F0aW9uU3RhcnQsXG4gIE5hdmlnYXRpb25FbmQsXG4gIE5hdmlnYXRpb25FcnJvcixcbiAgUm91dGVyLFxuICBFdmVudCxcbiAgQWN0aXZhdGVkUm91dGUsXG4gIEFjdGl2YXRpb25FbmQsXG59IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcidcbmltcG9ydCB7IEhlbHBQYWdlQVBJU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL2FwaS9zZXJ2aWNlcy9oZWxwLXBhZ2UtYXBpLnNlcnZpY2UnXG5pbXBvcnQgeyBNZXNzYWdlU2VydmljZSwgTWVudUl0ZW0sIFByaW1lTkdDb25maWcgfSBmcm9tICdwcmltZW5nL2FwaSdcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdwcmltZW5nL2R5bmFtaWNkaWFsb2cnXG5pbXBvcnQgeyBIZWxwRGF0YSwgUG9ydGFsTWVudUl0ZW0gfSBmcm9tICcuLi8uLi8uLi9hcGkvbW9kZWwnXG5pbXBvcnQgeyBOb0hlbHBJbmZvQ29tcG9uZW50IH0gZnJvbSAnLi4vbm8taGVscC1pbmZvL25vLWhlbHAtaW5mby5jb21wb25lbnQnXG5pbXBvcnQgeyBpc1RraXRQYWdlIH0gZnJvbSAnLi4vLi4vcGFnZXMvUG9ydGFsUGFnZSdcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJ1xuaW1wb3J0IHsgQ29uZmlndXJhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9hcGkvY29uZmlndXJhdGlvbi5zZXJ2aWNlJ1xuaW1wb3J0IHsgVGhlbWVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vYXBpL3NlcnZpY2VzL3RoZW1lLnNlcnZpY2UnXG5pbXBvcnQgeyBNZW51QXBpU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL2FwaS9zZXJ2aWNlcy9tZW51LWFwaS5zZXJ2aWNlJ1xuaW1wb3J0IHsgQVVUSF9TRVJWSUNFIH0gZnJvbSAnLi4vLi4vLi4vYXBpL2luamVjdGlvbi10b2tlbnMnXG5pbXBvcnQgeyBJQXV0aFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9hcGkvaWF1dGguc2VydmljZSdcbmltcG9ydCB7IENPTkZJR19LRVlfVEtJVF9QT1JUQUxfRElTQUJMRV9USEVNRV9NQU5BR0VNRU5UIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgUG9ydGFsIH0gZnJvbSAnLi4vLi4vLi4vYXBpL21vZGVsL3BvcnRhbCdcbmltcG9ydCB7IE92ZXJsYXlQYW5lbCB9IGZyb20gJ3ByaW1lbmcvb3ZlcmxheXBhbmVsJ1xuaW1wb3J0IHsgQnJlYWtwb2ludE9ic2VydmVyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2xheW91dCdcbmltcG9ydCB7IEZlZWRiYWNrQmFzaWMsIEZlZWRiYWNrRFRPIH0gZnJvbSAnLi4vLi4vLi4vYXBpL21vZGVsL2ZlZWRiYWNrLm1vZGVsJ1xuaW1wb3J0IHsgRmVlZGJhY2tBcGlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vYXBpL3NlcnZpY2VzL2ZlZWRiYWNrLWFwaS5zZXJ2aWNlJ1xuaW1wb3J0IHsgU3VwcG9ydFRpY2tldCB9IGZyb20gJy4uLy4uLy4uL2FwaS9tb2RlbC9zdXBwb3J0LXRpY2tldC5tb2RlbCdcbmltcG9ydCB7IFN1cHBvcnRUaWNrZXRBcGlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vYXBpL3NlcnZpY2VzL3N1cHBvcnQtdGlja2V0LWFwaS5zZXJ2aWNlJ1xuaW1wb3J0IHsgTWVudVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vLi4vYXBpL3NlcnZpY2VzL21lbnUuc2VydmljZVwiO1xuXG5lbnVtIE1lbnVPcmllbnRhdGlvbiB7XG4gIFNUQVRJQyxcbiAgT1ZFUkxBWSxcbiAgU0xJTSxcbiAgSE9SSVpPTlRBTCxcbn1cbmNvbnN0IEZBTExCQUNLX1RIRU1FX1VSTCA9ICcuL3BvcnRhbC1saWIvYXNzZXRzL2Nzcy9mYWxsYmFjay10aGVtZS9mYWxsYmFjay5jc3MnXG5jb25zdCBERUZBVUxUX0JBU0VfVVJMID0gJ2h0dHBzOi8vMTAwMGtpdC5hdGxhc3NpYW4ubmV0L3dpa2kvc3BhY2VzLzEwMDBLSVQvb3ZlcnZpZXcnXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RrLXBvcnRhbC12aWV3cG9ydCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wb3J0YWwtdmlld3BvcnQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICAubG9hZGluZy1ibG9jayB7XG4gICAgICB9XG4gICAgYCxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUG9ydGFsVmlld3BvcnRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQge1xuXG4gIEBJbnB1dCgpXG4gIHNob3dQcm9maWxlSW5TaWRlYmFyID0gdHJ1ZVxuXG4gIEBJbnB1dCgpXG4gIGVuYWJsZUJyZWFkY3J1bWJzID0gZmFsc2VcblxuICBASW5wdXQoKVxuICBmdWxsUG9ydGFsTGF5b3V0ID0gdHJ1ZVxuXG4gIC8vIFRLSVRcbiAgaGVscFBhZ2VFZGl0b3JEaXNwbGF5ZWQgPSBmYWxzZVxuICBhZGRUb0Zhdm91cml0ZXNEaXNwbGF5ZWQgPSBmYWxzZVxuICBzdXBwb3J0VGlja2V0RGlzcGxheWVkID0gZmFsc2VcbiAgY3VycmVudENvbXBvbmVudDogYW55XG4gIGZlZWRiYWNrRGF0YTogRmVlZGJhY2tCYXNpYyA9IHsgY29tbWVudDogJycsIHJhdGluZzogMCwgYW5vbnltb3VzOiBmYWxzZSB9XG4gIGZlZWRiYWNrVmlzaWJsZSA9IGZhbHNlXG4gIGZlZWRiYWNrU3VibWl0RGlzYWJsZWQgPSBmYWxzZVxuXG4gIEBJbnB1dCgpXG4gIGFwcE5hbWU6IHN0cmluZ1xuXG4gIEBJbnB1dCgpXG4gIHBvcnRhbE5hbWUgPSAnUE9SVEFMJ1xuXG4gIGFwcFZlcnNpb246IHN0cmluZ1xuXG4gIGlzQm9keUNvbXBhY3Q6IGJvb2xlYW5cbiAgaGVscERhdGFJdGVtOiBIZWxwRGF0YVxuICBoZWxwQXJ0aWNsZUlkOiBzdHJpbmdcbiAgc2lkZUJhckNvbG9yVGhlbWU6IHN0cmluZ1xuXG4gIC8vIFBSSU1FTkcgU1RVRkZcbiAgbGF5b3V0TW9kZTogTWVudU9yaWVudGF0aW9uID0gTWVudU9yaWVudGF0aW9uLlNUQVRJQ1xuXG4gIC8vIFRPRE8gVWx0aW1hMTE6IGRhcmsgbWVudVxuICBkYXJrTWVudSA9IGZhbHNlXG5cbiAgcHJvZmlsZU1vZGUgPSAndG9wJ1xuXG4gIG1lbnVBY3RpdmU6IGJvb2xlYW5cblxuICBtb2JpbGVNZW51QWN0aXZlOiBib29sZWFuXG5cbiAgaW5saW5lTWVudUFjdGl2ZTogYm9vbGVhblxuXG4gIG1lbnVDbGljazogYm9vbGVhblxuXG4gIGlubGluZU1lbnVDbGljazogYm9vbGVhblxuXG4gIHN0YXRpY01lbnVEZXNrdG9wSW5hY3RpdmU6IGJvb2xlYW5cblxuICBtb2JpbGVUb3BiYXJBY3RpdmU6IGJvb2xlYW5cblxuICBzaG93TWVudUJ1dHRvblRpdGxlOiBzdHJpbmdcblxuICBoaWRlTWVudUJ1dHRvblRpdGxlOiBzdHJpbmdcblxuICB0b3BiYXJJdGVtQ2xpY2s6IGJvb2xlYW5cblxuICBhY3RpdmVUb3BiYXJJdGVtOiBhbnlcblxuICByZXNldE1lbnU6IGJvb2xlYW5cblxuICBtZW51SG92ZXJBY3RpdmU6IGJvb2xlYW5cblxuICBzZWFyY2hDbGljayA9IGZhbHNlO1xuXG4gIHNlYXJjaCA9IGZhbHNlO1xuXG4gIGRvY3VtZW50Q2xpY2tMaXN0ZW5lcjogKCkgPT4gdm9pZFxuXG4gIEBWaWV3Q2hpbGQoJ2xheW91dENvbnRhaW5lcicpXG4gIGxheW91dENvbnRhaW5lclZpZXdDaGlsZDogRWxlbWVudFJlZlxuXG4gIEBWaWV3Q2hpbGQoJ3Njcm9sbFBhbmVsJylcbiAgbGF5b3V0TWVudVNjcm9sbGVyVmlld0NoaWxkOiBTY3JvbGxQYW5lbFxuXG4gIEBWaWV3Q2hpbGQoJ2ZlZWRiYWNrUGFuZWwnKVxuICBmZWVkYmFja1BhbmVsOiBPdmVybGF5UGFuZWxcblxuICBwcmVsb2FkZXIgPSB0cnVlXG4gIHBvcnRhbE1lbnVJdGVtczogTWVudUl0ZW1bXVxuICBsYW5nOiBzdHJpbmdcbiAgcG9ydGFsSG9tZU1lbnVJdGVtOiBNZW51SXRlbSA9IHsgdXJsOiAnLycsIGxhYmVsOiAnSG9tZScgfVxuICBpbml0RXJyb3I6IGFueVxuXG4gIG1haW5Qb3J0YWw6IFBvcnRhbFxuXG4gIGdldCBtZW51QnV0dG9uVGl0bGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gKFxuICAgICAgICB0aGlzLmlzRGVza3RvcCgpICYmIHRoaXMubWVudUFjdGl2ZSB8fCB0aGlzLmlzTW9iaWxlKCkgJiYgdGhpcy5tb2JpbGVNZW51QWN0aXZlXG4gICAgKSA/IHRoaXMuaGlkZU1lbnVCdXR0b25UaXRsZSA6IHRoaXMuc2hvd01lbnVCdXR0b25UaXRsZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZW5kZXJlcjI6IFJlbmRlcmVyMixcbiAgICBwdWJsaWMgem9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSBoZWxwRGF0YVNlcnZpY2U6IEhlbHBQYWdlQVBJU2VydmljZSxcbiAgICBwcml2YXRlIG1lc3NhZ2VTZXJ2aWNlOiBNZXNzYWdlU2VydmljZSxcbiAgICBwcml2YXRlIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBicmVha3BvaW50T2JzZXJ2ZXI6IEJyZWFrcG9pbnRPYnNlcnZlcixcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIHRoZW1lU2VydmljZTogVGhlbWVTZXJ2aWNlLFxuICAgIHByaXZhdGUgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlLFxuICAgIHByaXZhdGUgbWVudUFwaVNlcnZpY2U6IE1lbnVBcGlTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29uZmlnU2VydmljZTogQ29uZmlndXJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBmZWVkYmFja0FwaVNlcnZpY2U6IEZlZWRiYWNrQXBpU2VydmljZSxcbiAgICBwcml2YXRlIHN1cHBvcnRUaWNrZXRBcGlTZXJ2aWNlOiBTdXBwb3J0VGlja2V0QXBpU2VydmljZSxcbiAgICBwcml2YXRlIHByaW1lTmdDb25maWc6IFByaW1lTkdDb25maWcsXG4gICAgQEluamVjdChBVVRIX1NFUlZJQ0UpIHByaXZhdGUgYXV0aDogSUF1dGhTZXJ2aWNlXG4gICkge31cblxuICBhcHBseVBhZGRpbmcoKSB7XG4gICAgaWYgKHRoaXMuaXNCb2R5Q29tcGFjdCkge1xuICAgICAgdGhpcy5hZGRDbGFzcyhkb2N1bWVudC5ib2R5LCAnY29tcGFjdCcpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwgJ2NvbXBhY3QnKVxuICAgIH1cbiAgfVxuXG4gIHNldFNpZGViYXJDb2xvclRoZW1lKCkge1xuICAgIGlmICh0aGlzLnNpZGVCYXJDb2xvclRoZW1lID09PSAnREFSSycpIHtcbiAgICAgIHRoaXMuZGFya01lbnUgPSB0cnVlXG4gICAgfSBlbHNlIGlmICh0aGlzLnNpZGVCYXJDb2xvclRoZW1lID09PSAnTElHSFQnKSB7XG4gICAgICB0aGlzLmRhcmtNZW51ID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnByaW1lTmdDb25maWcucmlwcGxlID0gdHJ1ZVxuICAgIHRoaXMuaW5pdEVycm9yID0gdGhpcy5jb25maWdTZXJ2aWNlLmVycm9yXG4gICAgaWYgKHRoaXMuaW5pdEVycm9yKSB7XG4gICAgICB0aGlzLnByZWxvYWRlciA9IGZhbHNlXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdGhpcy5tYWluUG9ydGFsID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldFBvcnRhbERhdGEoKVxuICAgIGlmICh0aGlzLmF1dGguY3VycmVudFVzZXIoKS5hY2NvdW50U2V0dGluZ3MubGF5b3V0QW5kVGhlbWVTZXR0aW5ncykge1xuICAgICAgdGhpcy5pc0JvZHlDb21wYWN0ID0gdGhpcy5hdXRoLmN1cnJlbnRVc2VyKCkuYWNjb3VudFNldHRpbmdzLmxheW91dEFuZFRoZW1lU2V0dGluZ3MuY29tcGFjdFZpZXcgPz8gZmFsc2VcbiAgICAgIHRoaXMuYXBwbHlQYWRkaW5nKClcbiAgICAgIC8vIHRoaXMuc2lkZUJhckNvbG9yVGhlbWUgPSB0aGlzLmF1dGguY3VycmVudFVzZXIoKS5hY2NvdW50U2V0dGluZ3MubGF5b3V0QW5kVGhlbWVTZXR0aW5ncy5tZW51VGhlbWUgPz8gJ0xJR0hUJ1xuICAgICAgaWYgKHRoaXMuYXV0aC5jdXJyZW50VXNlcigpLmFjY291bnRTZXR0aW5ncy5sYXlvdXRBbmRUaGVtZVNldHRpbmdzLnNpZGViYXJWaWV3TW9kZSkge1xuICAgICAgICB0aGlzLmxheW91dE1vZGUgPVxuICAgICAgICAgIE1lbnVPcmllbnRhdGlvblt0aGlzLmF1dGguY3VycmVudFVzZXIoKS5hY2NvdW50U2V0dGluZ3MubGF5b3V0QW5kVGhlbWVTZXR0aW5ncy5zaWRlYmFyVmlld01vZGVdXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxheW91dE1vZGUgPSBNZW51T3JpZW50YXRpb25bJ1NUQVRJQyddXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5tZW51QWN0aXZlID0gdGhpcy5pc1N0YXRpYygpICYmICF0aGlzLmlzTW9iaWxlKCkgJiYgdGhpcy5mdWxsUG9ydGFsTGF5b3V0O1xuXG4gICAgdGhpcy52YWxpZGF0ZVJlcXVpcmVkSW5wdXRzKClcblxuICAgIHRoaXMuc2V0U2lkZWJhckNvbG9yVGhlbWUoKVxuICAgIHRoaXMuc2V0Q3VzdG9tVGhlbWUoKVxuXG4gICAgaWYgKHRoaXMuZnVsbFBvcnRhbExheW91dCkge1xuICAgICAgdGhpcy5sb2FkTWVudUl0ZW1zKClcbiAgICB9XG5cbiAgICB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKChldmVudDogRXZlbnQpID0+IHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGBuYXYgZXZlbnQgJHtldmVudC5jb25zdHJ1Y3Rvci5uYW1lfWApO1xuICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvblN0YXJ0KSB7XG4gICAgICAgIC8vIFNob3cgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgQWN0aXZhdGlvbkVuZCkge1xuICAgICAgICAvLyB0aGlzLmhlbHBBcnRpY2xlSWQgPSBldmVudC5zbmFwc2hvdC5wYXRoRnJvbVJvb3RcbiAgICAgICAgLy8gICAubWFwKGkgPT4gKGkucm91dGVDb25maWcgPyBpLnJvdXRlQ29uZmlnLnBhdGggOiAnJykpXG4gICAgICAgIC8vICAgLmpvaW4oJy8nKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYGFmdGdlciBldmVudCAke3RoaXMuaGVscEFydGljbGVJZH1gKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCAmJiB0aGlzLmZ1bGxQb3J0YWxMYXlvdXQpIHtcbiAgICAgICAgLy8gSGlkZSBsb2FkaW5nIGluZGljYXRvclxuXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDb21wb25lbnQpIHtcbiAgICAgICAgICBsZXQgaGVscFBhZ2VJZGVudGlmaWVyXG4gICAgICAgICAgaWYgKGlzVGtpdFBhZ2UodGhpcy5jdXJyZW50Q29tcG9uZW50KSkge1xuICAgICAgICAgICAgaGVscFBhZ2VJZGVudGlmaWVyID0gdGhpcy5jdXJyZW50Q29tcG9uZW50LmhlbHBBcnRpY2xlSWRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGVscFBhZ2VJZGVudGlmaWVyID0gZXZlbnQudXJsIHx8IHRoaXMuY3VycmVudENvbXBvbmVudC5jb25zdHJ1Y3Rvci5uYW1lXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgUGFnZSBkb2VzIG5vdCBoYXZlIGhlbHBJdGVtSWQsIHVzaW5nIHJvdXRlciBwYXRoICR7aGVscFBhZ2VJZGVudGlmaWVyfWApXG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuaGVscEFydGljbGVJZCA9IGhlbHBQYWdlSWRlbnRpZmllclxuICAgICAgICAgIHRoaXMuaGVscERhdGFJdGVtID0ge1xuICAgICAgICAgICAgaGVscEl0ZW1JZDogaGVscFBhZ2VJZGVudGlmaWVyLFxuICAgICAgICAgICAgYXBwSWQ6IHRoaXMuYXBwTmFtZSxcbiAgICAgICAgICAgIGJhc2VVcmw6IERFRkFVTFRfQkFTRV9VUkwsXG4gICAgICAgICAgICByZXNvdXJjZVVybDogJycsXG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubG9hZEhlbHBBcnRpY2xlKClcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRXJyb3IpIHtcbiAgICAgICAgLy8gSGlkZSBsb2FkaW5nIGluZGljYXRvclxuXG4gICAgICAgIC8vIFByZXNlbnQgZXJyb3IgdG8gdXNlclxuICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmFkZCh7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgc3VtbWFyeTogJ05hdmlnYXRpb24gZXJyb3InLFxuICAgICAgICAgIGRldGFpbDogYFJvdXRlICR7ZXZlbnQudXJsfSBub3QgcmVjb2duaXplZGAsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICAvLyBjb25zb2xlLmxvZyhgbmF2aWdhdGUgZXZlbnQgJHtldmVudH1gKTtcbiAgICAgIHRoaXMuc2V0U2lkZWJhckNvbG9yVGhlbWUoKVxuICAgIH0pXG5cbiAgICB0aGlzLnRyYW5zbGF0ZS5nZXQoWydHRU5FUkFMLlNIT1dfTUVOVScsICdHRU5FUkFMLkhJREVfTUVOVSddKS5zdWJzY3JpYmUodGV4dCA9PiB7XG4gICAgICAgIHRoaXMuaGlkZU1lbnVCdXR0b25UaXRsZSA9IHRleHRbJ0dFTkVSQUwuSElERV9NRU5VJ11cbiAgICAgICAgdGhpcy5zaG93TWVudUJ1dHRvblRpdGxlID0gdGV4dFsnR0VORVJBTC5TSE9XX01FTlUnXVxuICAgIH0pXG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5kb2N1bWVudENsaWNrTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyMi5saXN0ZW4oJ2JvZHknLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMudG9wYmFySXRlbUNsaWNrKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlVG9wYmFySXRlbSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5tZW51Q2xpY2sgJiYgKHRoaXMuaXNIb3Jpem9udGFsKCkgfHwgdGhpcy5pc1NsaW0oKSkpIHtcbiAgICAgICAgdGhpcy5tZW51U2VydmljZS5yZXNldCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMubWVudUNsaWNrKSB7XG4gICAgICAgIGlmICh0aGlzLm1vYmlsZU1lbnVBY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLm1vYmlsZU1lbnVBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT3ZlcmxheSgpKSB7XG4gICAgICAgICAgdGhpcy5tZW51QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1lbnVIb3ZlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnVuYmxvY2tCb2R5U2Nyb2xsKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5zZWFyY2hDbGljaykge1xuICAgICAgICB0aGlzLnNlYXJjaCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pbmxpbmVNZW51QWN0aXZlICYmICF0aGlzLmlubGluZU1lbnVDbGljaykge1xuICAgICAgICB0aGlzLmlubGluZU1lbnVBY3RpdmUgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbmxpbmVNZW51Q2xpY2sgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2VhcmNoQ2xpY2sgPSBmYWxzZTtcbiAgICAgIHRoaXMudG9wYmFySXRlbUNsaWNrID0gZmFsc2U7XG4gICAgICB0aGlzLm1lbnVDbGljayA9IGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgbG9hZE1lbnVJdGVtcygpIHtcbiAgICBjb25zdCBwb3J0YWxJZCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRQcm9wZXJ0eSgnVEtJVF9QT1JUQUxfSUQnKVxuICAgIGNvbnN0IHN0cmlwRm9yYmlkZGVuU3RyID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldFByb3BlcnR5KCdUS0lUX1BPUlRBTF9ESVNBQkxFX01FTlVfUEVSTUlTU0lPTlMnKVxuICAgIGNvbnN0IHN0cmlwRm9yYmlkZGVuID0gc3RyaXBGb3JiaWRkZW5TdHIgPT09ICd0cnVlJ1xuICAgIHRoaXMuY29uZmlnU2VydmljZS5sYW5nJC5zdWJzY3JpYmUoZGF0YSA9PiAodGhpcy5sYW5nID0gZGF0YSkpLnVuc3Vic2NyaWJlKClcblxuICAgIGlmICghcG9ydGFsSWQpIHtcbiAgICAgIHRoaXMucG9ydGFsTWVudUl0ZW1zID0gW3sgbGFiZWw6ICdGYWlsZWQgdG8gbG9hZCBtZW51JywgaWNvbjogJ2Rhc2hib2FyZCcsIHJvdXRlckxpbms6IFsnLyddIH1dXG4gICAgfSBlbHNlIGlmICh0aGlzLmZ1bGxQb3J0YWxMYXlvdXQpIHtcbiAgICAgIHRoaXMubWVudUFwaVNlcnZpY2UuZ2V0TWVudUl0ZW1zKHBvcnRhbElkKS5zdWJzY3JpYmUoZGF0YSA9PiB7XG4gICAgICAgIGxldCBzZXJ2ZXJNZW51SXRlbXM6IE1lbnVJdGVtW10gPSBbXVxuICAgICAgICBjb25zdCBtYWluTWVudUl0ZW0gPSBkYXRhLmZpbmQoaXRlbSA9PiBpdGVtLmtleSA9PT0gJ1BPUlRBTF9NQUlOX01FTlUnKVxuICAgICAgICB0aGlzLnBvcnRhbEhvbWVNZW51SXRlbSA9IHRoaXMudG9QcmltZU5HTWVudUl0ZW0oZGF0YS5maW5kKGl0ZW0gPT4gaXRlbS5rZXkgPT09ICdQT1JUQUxfTUVOVV9IT01FJykpXG4gICAgICAgIGlmICghdGhpcy5wb3J0YWxIb21lTWVudUl0ZW0pIHtcbiAgICAgICAgICB0aGlzLnBvcnRhbEhvbWVNZW51SXRlbSA9IHsgdXJsOiAnLycsIGxhYmVsOiAnSG9tZScgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChtYWluTWVudUl0ZW0pIHtcbiAgICAgICAgICBzZXJ2ZXJNZW51SXRlbXMgPSBtYWluTWVudUl0ZW0uY2hpbGRyZW5cbiAgICAgICAgICAgIC5maWx0ZXIoXG4gICAgICAgICAgICAgIGl0ZW0gPT4gKCFzdHJpcEZvcmJpZGRlbiB8fCB0aGlzLmF1dGguaGFzUGVybWlzc2lvbihgJHtpdGVtLnBlcm1pc3Npb25PYmplY3R9I1ZJRVdgKSkgJiYgIWl0ZW0uZGlzYWJsZWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zb3J0KChhOiBQb3J0YWxNZW51SXRlbSwgYjogUG9ydGFsTWVudUl0ZW0pID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKVxuICAgICAgICAgICAgLm1hcChpdGVtID0+IHRoaXMudG9QcmltZU5HTWVudUl0ZW0oaXRlbSkpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wb3J0YWxNZW51SXRlbXMgPSBbXG4gICAgICAgICAgLy8geyBsYWJlbDogJ1BvcnRhbCBIb21lJywgaWNvbjogJ2Rhc2hib2FyZCcsIHJvdXRlckxpbms6IFsnLyddIH0sXG4gICAgICAgICAgLi4uc2VydmVyTWVudUl0ZW1zLFxuICAgICAgICBdXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdG9QcmltZU5HTWVudUl0ZW0oaXRlbTogUG9ydGFsTWVudUl0ZW0sIGxldmVsID0gMSk6IE1lbnVJdGVtIHtcbiAgICBpZiAoIWl0ZW0pIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG4gICAgbGV0IGlzQWJzb2x1dGVMaW5rID0gaXRlbS51cmwgJiYgaXRlbS51cmwubWF0Y2goL14oaHR0cHxodHRwcykvZykgIT09IG51bGxcbiAgICBjb25zdCBjdXJyZW50SG9zdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdiYXNlJylbMF0uaHJlZlxuICAgIGxldCByb3V0ZXJMaW5rID0gdW5kZWZpbmVkXG4gICAgY29uc3QgbGFiZWwgPSBpdGVtLmkxOG5bdGhpcy5sYW5nXSB8fCBpdGVtLm5hbWVcbiAgICBpZiAodGhpcy5hcHBOYW1lID09PSBpdGVtLmFwcGxpY2F0aW9uSWQpIHtcbiAgICAgIC8vIGl0IGlzIGEgbG9jYWwgbGluaywgc2V0IHJvdXRlcmxpbmtcbiAgICAgIGlmIChpc0Fic29sdXRlTGluayAmJiBpdGVtLnVybC5pbmNsdWRlcyhjdXJyZW50SG9zdCkpIHtcbiAgICAgICAgcm91dGVyTGluayA9IFtpdGVtLnVybC5zdWJzdHIoY3VycmVudEhvc3QubGVuZ3RoIC0gMSldXG4gICAgICAgIGlzQWJzb2x1dGVMaW5rID0gZmFsc2VcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBjdXJyZW50SG9zdC5zdWJzdHJpbmcod2luZG93LmxvY2F0aW9uLm9yaWdpbi5sZW5ndGgpXG4gICAgICAgIGlmIChwYXRoLmxlbmd0aCA+PSAxICYmIGl0ZW0udXJsLnN0YXJ0c1dpdGgocGF0aCkpIHtcbiAgICAgICAgICAvLyBpdHMgYSBsaW5rIHdpdGhpbiBzYW1lICBwYXRoXG4gICAgICAgICAgcm91dGVyTGluayA9IFtpdGVtLnVybC5zdWJzdHIocGF0aC5sZW5ndGggLSAxKV1cbiAgICAgICAgICBpc0Fic29sdXRlTGluayA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGJhZGdlSWNvbiA9IGxldmVsID09PSAxID8gJ21lbnUnIDogJ3N1YmplY3QnXG4gICAgaWYgKGl0ZW0uYmFkZ2UgIT09ICcnICYmIGl0ZW0uYmFkZ2UpIHtcbiAgICAgIGJhZGdlSWNvbiA9IGl0ZW0uYmFkZ2VcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVsLFxuICAgICAgLy8gYmFkZ2U6ICfwn5SXJyxcbiAgICAgIGljb246IGJhZGdlSWNvbixcbiAgICAgIGNvbW1hbmQ6IGUgPT4ge1xuICAgICAgICBlLm9yaWdpbmFsRXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpdGVtLnBvcnRhbEV4aXRcbiAgICAgICAgICAgID8gd2luZG93Lm9wZW4oaXRlbS51cmwsICdfYmxhbmsnKVxuICAgICAgICAgICAgOiByb3V0ZXJMaW5rXG4gICAgICAgICAgICA/IHRoaXMucm91dGVyLm5hdmlnYXRlKHJvdXRlckxpbmspXG4gICAgICAgICAgICA6IHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24oaXRlbS51cmwpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1cmw6IGl0ZW0udXJsLFxuICAgICAgcm91dGVyTGlua0FjdGl2ZU9wdGlvbnM6IFt7IGV4YWN0OiBmYWxzZSB9XSxcbiAgICAgIGl0ZW1zOlxuICAgICAgICBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDBcbiAgICAgICAgICA/IGl0ZW0uY2hpbGRyZW5cbiAgICAgICAgICAgICAgLmZpbHRlcihjaGlsZCA9PiAhY2hpbGQuZGlzYWJsZWQpXG4gICAgICAgICAgICAgIC5zb3J0KChhOiBQb3J0YWxNZW51SXRlbSwgYjogUG9ydGFsTWVudUl0ZW0pID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKVxuICAgICAgICAgICAgICAubWFwKGNoaWxkID0+IHRoaXMudG9QcmltZU5HTWVudUl0ZW0oY2hpbGQsIGxldmVsICsgMSkpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGVSZXF1aXJlZElucHV0cygpIHtcbiAgICBpZiAoIXRoaXMuYXBwTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBZb3UgbXVzdCBzcGVjaWZ5IFthcHBOYW1lXSBhdHRyaWJ1dGUgb24gPHRrLXBvcnRhbC12aWV3cG9ydD4gY29tcG9uZW50LmApXG4gICAgfVxuICB9XG5cbiAgbG9hZEhlbHBBcnRpY2xlKCkge1xuICAgIHRoaXMuaGVscERhdGFTZXJ2aWNlLmdldEhlbHBEYXRhSXRlbSh0aGlzLmFwcE5hbWUsIHRoaXMuaGVscEFydGljbGVJZCkuc3Vic2NyaWJlKFxuICAgICAgZGF0YSA9PiB7XG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgdGhpcy5oZWxwRGF0YUl0ZW0gPSBkYXRhXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlcnJvciA9PiBjb25zb2xlLmxvZygnRmFpbGVkIHRvIGxvYWQgaGVscCBhcnRpY2xlJylcbiAgICApXG4gIH1cblxuICBwdWJsaWMgb25IZWxwQXJ0aWNsZUVkaXRvckNsb3NlZChjaGFuZ2VkOiBib29sZWFuKSB7XG4gICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgIHRoaXMuaGVscERhdGFTZXJ2aWNlLnNhdmVIZWxwUGFnZSh0aGlzLmFwcE5hbWUsIHRoaXMuaGVscERhdGFJdGVtKS5zdWJzY3JpYmUoXG4gICAgICAgIHJlcyA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYEhlbHAgaXRlbSBzYXZlZDogJHtyZXMuc3RhdHVzfWApXG4gICAgICAgICAgdGhpcy5oZWxwUGFnZUVkaXRvckRpc3BsYXllZCA9IGZhbHNlXG5cbiAgICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmFkZCh7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2luZm8nLFxuICAgICAgICAgICAgc3VtbWFyeTogJ0hlbHAgSXRlbSBkZWZpbml0aW9uIHVwZGF0ZWQnLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgdGhpcy5sb2FkSGVscEFydGljbGUoKVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYENvdWxkIG5vdCBzYXZlIGhlbHAgaXRlbWApXG4gICAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5hZGQoe1xuICAgICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgICBzdW1tYXJ5OiAnSGVscCBJdGVtIGRlZmluaXRpb24gdXBkYXRlIGZhaWxlZCcsXG4gICAgICAgICAgICBkZXRhaWw6IGBTZXJ2ZXIgZXJyb3I6ICR7ZXJyb3Iuc3RhdHVzfWAsXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmhlbHBQYWdlRWRpdG9yRGlzcGxheWVkID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25BZGRUb0xhdW5jaHBhZENsb3NlZChldmVudCkge1xuICAgIHRoaXMuYWRkVG9GYXZvdXJpdGVzRGlzcGxheWVkID0gZmFsc2VcbiAgfVxuXG4gIHB1YmxpYyBvcGVuSGVscFBhZ2UoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5oZWxwRGF0YUl0ZW0uaWQpIHtcbiAgICAgIGNvbnN0IHVybCA9IHRoaXMuaGVscERhdGFJdGVtLmJhc2VVcmxcbiAgICAgICAgPyBgJHt0aGlzLmhlbHBEYXRhSXRlbS5iYXNlVXJsfS8ke3RoaXMuaGVscERhdGFJdGVtLnJlc291cmNlVXJsfWBcbiAgICAgICAgOiB0aGlzLmhlbHBEYXRhSXRlbS5yZXNvdXJjZVVybFxuICAgICAgY29uc29sZS5sb2coYG5hdmlnYXRlIHRvIGhlbHAgcGFnZTogJHt1cmx9YClcbiAgICAgIGNvbnN0IHdpbiA9IHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycpXG4gICAgICB3aW4uZm9jdXMoKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpYWxvZ1NlcnZpY2Uub3BlbihOb0hlbHBJbmZvQ29tcG9uZW50LCB7XG4gICAgICAgIGhlYWRlcjogJ05vIGhlbHAgaXRlbSBkZWZpbmVkIGZvciB0aGlzIHBhZ2UnLFxuICAgICAgICB3aWR0aDogJzQwMHB4JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHBhZ2VJdGVtOiB0aGlzLmhlbHBBcnRpY2xlSWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH1cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gIH1cblxuICBwdWJsaWMgb3BlbkhlbHBQYWdlRWRpdG9yKGV2ZW50KSB7XG4gICAgdGhpcy5oZWxwUGFnZUVkaXRvckRpc3BsYXllZCA9IHRydWVcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gIH1cblxuICBwdWJsaWMgb3BlbkZlZWRiYWNrKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuYnJlYWtwb2ludE9ic2VydmVyLmlzTWF0Y2hlZCgnKG1heC13aWR0aDogMTAyNHB4KScpKSB7XG4gICAgICB0aGlzLmZlZWRiYWNrVmlzaWJsZSA9IHRydWVcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mZWVkYmFja1BhbmVsLnRvZ2dsZShldmVudClcbiAgICB9XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICB9XG5cbiAgcHVibGljIG9wZW5BZGRUb0xhdW5jaHBhZChldmVudCkge1xuICAgIHRoaXMuYWRkVG9GYXZvdXJpdGVzRGlzcGxheWVkID0gdHJ1ZVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgfVxuXG4gIHB1YmxpYyBvcGVuU3VwcG9ydFRpY2tldChldmVudCkge1xuICAgIHRoaXMuc3VwcG9ydFRpY2tldERpc3BsYXllZCA9IHRydWVcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gIH1cblxuICBwdWJsaWMgb25TdWJtaXRGZWVkYmFjayhmZWVkYmFjazogRmVlZGJhY2tCYXNpYykge1xuICAgIHRoaXMuZmVlZGJhY2tTdWJtaXREaXNhYmxlZCA9IHRydWVcbiAgICBjb25zdCBmZWVkYmFja0RUTzogRmVlZGJhY2tEVE8gPSB7XG4gICAgICByYXRpbmc6IGZlZWRiYWNrLnJhdGluZyxcbiAgICAgIGNvbW1lbnQ6IGZlZWRiYWNrLmNvbW1lbnQsXG4gICAgICBhcHBJZDogdGhpcy5hcHBOYW1lLFxuICAgICAgdXNlcklkOiBmZWVkYmFjay5hbm9ueW1vdXMgPyAnYW5vbnltb3VzJyA6IHRoaXMuYXV0aC5jdXJyZW50VXNlcigpLnVzZXJJZCxcbiAgICB9XG4gICAgdGhpcy5mZWVkYmFja0FwaVNlcnZpY2Uuc2VuZEZlZWRiYWNrKGZlZWRiYWNrRFRPKS5zdWJzY3JpYmUoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xvc2VGZWVkYmFjaygpXG4gICAgICAgIHRoaXMubWVzc2FnZVNlcnZpY2UuYWRkKHtcbiAgICAgICAgICBzZXZlcml0eTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIHN1bW1hcnk6ICdGZWVkYmFjayBzdWNjZXNzZnVsbHkgc2VudCcsXG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLmNsb3NlRmVlZGJhY2soKVxuICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmFkZCh7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgc3VtbWFyeTogJ1NlbmRpbmcgZmVlZGJhY2sgZmFpbGVkJyxcbiAgICAgICAgICBkZXRhaWw6ICdQbGVhc2UgdHJ5IGFnYWluIGxhdGVyJyxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApXG4gIH1cblxuICBjbG9zZUZlZWRiYWNrKCkge1xuICAgIHRoaXMuZmVlZGJhY2tTdWJtaXREaXNhYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5mZWVkYmFja1Zpc2libGUgPSBmYWxzZVxuICAgIHRoaXMuZmVlZGJhY2tQYW5lbC5oaWRlKClcbiAgfVxuXG4gIHB1YmxpYyBvblN1Ym1pdFRpY2tldCh0aWNrZXQ6IFN1cHBvcnRUaWNrZXQpIHtcbiAgICB0aGlzLnN1cHBvcnRUaWNrZXRBcGlTZXJ2aWNlLmNyZWF0ZVN1cHBvcnRUaWNrZXQodGlja2V0LCB0aGlzLmFwcE5hbWUpLnN1YnNjcmliZShcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5hZGQoe1xuICAgICAgICAgIHNldmVyaXR5OiAnc3VjY2VzcycsXG4gICAgICAgICAgc3VtbWFyeTogJ1N1Y2Nlc3MhJyxcbiAgICAgICAgICBkZXRhaWw6ICdUaWNrZXQgc3VjY2Vzc2Z1bGx5IHN1Ym1pdHRlZCcsXG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgKCkgPT5cbiAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5hZGQoe1xuICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgIHN1bW1hcnk6ICdFcnJvciEnLFxuICAgICAgICAgIGRldGFpbDogJ0Vycm9yIG9jY3VyZWQgd2hpbGUgc3VibWl0dGluZyBhIHRpY2tldCcsXG4gICAgICAgIH0pXG4gICAgKVxuICB9XG5cbiAgcHVibGljIGNsZWFyRmVlZGJhY2soKSB7XG4gICAgdGhpcy5mZWVkYmFja0RhdGEgPSB7IGNvbW1lbnQ6ICcnLCByYXRpbmc6IDAsIGFub255bW91czogZmFsc2UgfVxuICB9XG5cbiAgYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0KSB7XG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKVxuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyBjbGFzc05hbWVcbiAgICB9XG4gIH1cblxuICByZW1vdmVDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHtcbiAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QpIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpXG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZShcbiAgICAgICAgICBuZXcgUmVnRXhwKCcoXnxcXFxcYiknICsgY2xhc3NOYW1lLnNwbGl0KCcgJykuam9pbignfCcpICsgJyhcXFxcYnwkKScsICdnaScpLFxuICAgICAgICAgICcgJ1xuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIG9uTWVudUJ1dHRvbkNsaWNrKGV2ZW50KSB7XG4gICAgdGhpcy5tZW51QWN0aXZlID0gIXRoaXMubWVudUFjdGl2ZTtcbiAgICB0aGlzLm1lbnVDbGljayA9IHRydWU7XG5cbiAgICBpZiAoIXRoaXMuaXNEZXNrdG9wKCkpIHtcbiAgICAgIHRoaXMubW9iaWxlTWVudUFjdGl2ZSA9ICF0aGlzLm1vYmlsZU1lbnVBY3RpdmU7XG4gICAgICBpZiAodGhpcy5tb2JpbGVNZW51QWN0aXZlKSB7XG4gICAgICAgIHRoaXMuYmxvY2tCb2R5U2Nyb2xsKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnVuYmxvY2tCb2R5U2Nyb2xsKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICB9XG5cbiAgb25NZW51Q2xpY2soJGV2ZW50KSB7XG4gICAgdGhpcy5tZW51Q2xpY2sgPSB0cnVlXG5cbiAgICBpZiAodGhpcy5pbmxpbmVNZW51QWN0aXZlICYmICF0aGlzLmlubGluZU1lbnVDbGljaykge1xuICAgICAgdGhpcy5pbmxpbmVNZW51QWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgb25JbmxpbmVNZW51Q2xpY2soZXZlbnQpIHtcbiAgICB0aGlzLmlubGluZU1lbnVBY3RpdmUgPSAhdGhpcy5pbmxpbmVNZW51QWN0aXZlO1xuICAgIHRoaXMuaW5saW5lTWVudUNsaWNrID0gdHJ1ZTtcbiAgfVxuXG4gIG9uVG9wYmFyTW9iaWxlQnV0dG9uQ2xpY2soZXZlbnQpIHtcbiAgICB0aGlzLm1vYmlsZVRvcGJhckFjdGl2ZSA9ICF0aGlzLm1vYmlsZVRvcGJhckFjdGl2ZVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgfVxuXG4gIG9uVG9wYmFySXRlbUNsaWNrKGV2ZW50LCBpdGVtKSB7XG4gICAgdGhpcy50b3BiYXJJdGVtQ2xpY2sgPSB0cnVlXG5cbiAgICBpZiAodGhpcy5hY3RpdmVUb3BiYXJJdGVtID09PSBpdGVtKSB7XG4gICAgICB0aGlzLmFjdGl2ZVRvcGJhckl0ZW0gPSBudWxsXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aXZlVG9wYmFySXRlbSA9IGl0ZW1cbiAgICB9XG5cbiAgICBpZiAoaXRlbSA9PT0gJ3NlYXJjaCcpIHtcbiAgICAgIHRoaXMuc2VhcmNoID0gIXRoaXMuc2VhcmNoO1xuICAgICAgdGhpcy5zZWFyY2hDbGljayA9ICF0aGlzLnNlYXJjaENsaWNrO1xuICAgIH1cblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgfVxuXG4gIG9uU2VhcmNoQ2xpY2soZXZlbnQsIHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuc2VhcmNoQ2xpY2sgPSB2YWxcbiAgICB0aGlzLnNlYXJjaCA9IHZhbFxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgfVxuXG4gIGlzRGVza3RvcCgpIHtcbiAgICByZXR1cm4gd2luZG93LmlubmVyV2lkdGggPiA5OTFcbiAgfVxuXG4gIGlzTW9iaWxlKCkge1xuICAgIHJldHVybiB3aW5kb3cuaW5uZXJXaWR0aCA8PSA5OTFcbiAgfVxuXG4gIGlzU3RhdGljKCkge1xuICAgIHJldHVybiB0aGlzLmxheW91dE1vZGUgPT09IE1lbnVPcmllbnRhdGlvbi5TVEFUSUNcbiAgfVxuXG4gIGlzT3ZlcmxheSgpIHtcbiAgICByZXR1cm4gdGhpcy5sYXlvdXRNb2RlID09PSBNZW51T3JpZW50YXRpb24uT1ZFUkxBWVxuICB9XG5cbiAgaXNIb3Jpem9udGFsKCkge1xuICAgIHJldHVybiB0aGlzLmxheW91dE1vZGUgPT09IE1lbnVPcmllbnRhdGlvbi5IT1JJWk9OVEFMXG4gIH1cblxuICBpc1NsaW0oKSB7XG4gICAgcmV0dXJuIHRoaXMubGF5b3V0TW9kZSA9PT0gTWVudU9yaWVudGF0aW9uLlNMSU1cbiAgfVxuXG4gIGNoYW5nZVRvU3RhdGljTWVudSgpIHtcbiAgICB0aGlzLmxheW91dE1vZGUgPSBNZW51T3JpZW50YXRpb24uU1RBVElDXG4gIH1cblxuICBjaGFuZ2VUb092ZXJsYXlNZW51KCkge1xuICAgIHRoaXMubGF5b3V0TW9kZSA9IE1lbnVPcmllbnRhdGlvbi5PVkVSTEFZXG4gIH1cblxuICBjaGFuZ2VUb0hvcml6b250YWxNZW51KCkge1xuICAgIHRoaXMubGF5b3V0TW9kZSA9IE1lbnVPcmllbnRhdGlvbi5IT1JJWk9OVEFMXG4gIH1cblxuICBjaGFuZ2VUb1NsaW1NZW51KCkge1xuICAgIHRoaXMubGF5b3V0TW9kZSA9IE1lbnVPcmllbnRhdGlvbi5TTElNXG4gIH1cblxuICBibG9ja0JvZHlTY3JvbGwoKTogdm9pZCB7XG4gICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0KSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2Jsb2NrZWQtc2Nyb2xsJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lICs9ICcgYmxvY2tlZC1zY3JvbGwnO1xuICAgIH1cbiAgfVxuXG4gIHVuYmxvY2tCb2R5U2Nyb2xsKCk6IHZvaWQge1xuICAgIGlmIChkb2N1bWVudC5ib2R5LmNsYXNzTGlzdCkge1xuICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdibG9ja2VkLXNjcm9sbCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgnKF58XFxcXGIpJyArXG4gICAgICAgICAgJ2Jsb2NrZWQtc2Nyb2xsJy5zcGxpdCgnICcpLmpvaW4oJ3wnKSArICcoXFxcXGJ8JCknLCAnZ2knKSwgJyAnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEN1c3RvbVRoZW1lKCkge1xuICAgIGNvbnN0IGRpc2FibGVQb3J0YWxUaGVtZU1nbXQgPVxuICAgICAgdGhpcy5jb25maWdTZXJ2aWNlLmdldFByb3BlcnR5KENPTkZJR19LRVlfVEtJVF9QT1JUQUxfRElTQUJMRV9USEVNRV9NQU5BR0VNRU5UKSA9PT0gJ3RydWUnXG4gICAgaWYgKGRpc2FibGVQb3J0YWxUaGVtZU1nbXQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgUG9ydGFsIHRoZW1lIG1nbXQgaXMgZGlzYWJsZWQuIFRvIGVuYWJsZSBpdCwgcmVtb3ZlIGVudiB2YXI6ICR7Q09ORklHX0tFWV9US0lUX1BPUlRBTF9ESVNBQkxFX1RIRU1FX01BTkFHRU1FTlR9YFxuICAgICAgKVxuICAgICAgdGhpcy5wcmVsb2FkZXIgPSBmYWxzZVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGBTZXR0aW5nIHRoZW1lIGR5bmFtaWNhbGx5YClcbiAgICBsZXQgY3VzdG9tVGhlbWUgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0UG9ydGFsRGF0YSgpICYmIHRoaXMuY29uZmlnU2VydmljZS5nZXRQb3J0YWxEYXRhKCkudGhlbWVOYW1lXG5cbiAgICBpZiAoIWN1c3RvbVRoZW1lKSB7XG4gICAgICBjb25zdCB0aGVtZUZyb21FbnYgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0UHJvcGVydHkoJ1RLSVRfUE9SVEFMX0RFRkFVTFRfVEhFTUUnKVxuICAgICAgaWYgKCF0aGVtZUZyb21FbnYpIHtcbiAgICAgICAgY29uc29sZS5sb2coYEN1c3RvbSB0aGVtZSBub3QgZGVmaW5lZCwgb3IgcG9ydGFsIGRhdGEgbm90IGF2YWlsYWJsZSwgc2V0dGluZyBkZWZhdWx0IHRoZW1lIENHYClcbiAgICAgICAgY3VzdG9tVGhlbWUgPSAnY2cnXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgQ3VzdG9tIHRoZW1lIG5vdCBkZWZpbmVkLCBvciBwb3J0YWwgZGF0YSBub3QgYXZhaWxhYmxlLCBzZXR0aW5nIHRoZW1lIGZyb20gJ1RLSVRfUE9SVEFMX0RFRkFVTFRfVEhFTUUnIHZhcjogJHt0aGVtZUZyb21FbnZ9IGBcbiAgICAgICAgKVxuICAgICAgICBjdXN0b21UaGVtZSA9IHRoZW1lRnJvbUVudlxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWUtY3NzJykpIHtcbiAgICAgIGNvbnN0IHRoZW1lTGlua1RvUmVtb3ZlOiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aGVtZS1jc3MnKVxuICAgICAgdGhlbWVMaW5rVG9SZW1vdmUucmVtb3ZlKClcbiAgICB9XG4gICAgY29uc3QgdGhlbWVMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpXG4gICAgdGhlbWVMaW5rLnNldEF0dHJpYnV0ZSgnaWQnLCAndGhlbWUtY3NzJylcbiAgICB0aGVtZUxpbmsuc2V0QXR0cmlidXRlKCdyZWwnLCAnc3R5bGVzaGVldCcpXG4gICAgdGhlbWVMaW5rLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2NzcycpXG4gICAgdGhlbWVMaW5rLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCd0aGVtZSBsb2FkIGRvbmUnKVxuICAgICAgdGhpcy5wcmVsb2FkZXIgPSBmYWxzZVxuICAgIH1cbiAgICB0aGVtZUxpbmsub25lcnJvciA9ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGBGYWlsZWQgdG8gbG9hZCB0aGVtZSBhc3NldHMgZm9yICcke2N1c3RvbVRoZW1lfSdgKVxuICAgICAgdGhlbWVMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIEZBTExCQUNLX1RIRU1FX1VSTClcbiAgICAgIHRoaXMucHJlbG9hZGVyID0gZmFsc2VcbiAgICB9XG4gICAgdGhlbWVMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHRoaXMudGhlbWVTZXJ2aWNlLmdldFRoZW1lSHJlZihjdXN0b21UaGVtZSkpXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZCh0aGVtZUxpbmspXG4gIH1cbn1cbiJdfQ==