import { Component, EventEmitter, Input, Output } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { MenuService } from '../../../api/services/menu.service';
import { NavigationEnd, Router } from "@angular/router";
import { filter } from "rxjs/operators";
export class AppMenuComponent {
    constructor() {
        this.menuActiveChange = new EventEmitter();
        this.mobileMenuActiveChange = new EventEmitter();
    }
    set portalMenu(items) {
        this.menuWithRoot = {
            label: 'Menu',
            icon: 'list',
            items: items
        };
    }
}
AppMenuComponent.decorators = [
    { type: Component, args: [{
                selector: 'tk-menu',
                template: "<ul class=\"layout-menu\" id=\"nav\" role=\"navigation\">\n  <li\n    tk-submenu\n    [item]=\"menuWithRoot\"\n    [index]=\"0\"\n    root=\"true\"\n    visible=\"true\"\n    [(menuActive)]=\"menuActive\"\n    [(mobileMenuActive)]=\"mobileMenuActive\"\n    [isStatic]=\"isStatic\"\n    [isSlim]=\"isSlim\"\n    [isHorizontal]=\"isHorizontal\"\n    [isMobile]=\"isMobile\"\n    [isDesktop]=\"isDesktop\"\n    [menuHoverActive]=\"menuHoverActive\"\n  ></li>\n</ul>\n"
            },] }
];
AppMenuComponent.ctorParameters = () => [];
AppMenuComponent.propDecorators = {
    menuActive: [{ type: Input }],
    isStatic: [{ type: Input }],
    isHorizontal: [{ type: Input }],
    isMobile: [{ type: Input }],
    isDesktop: [{ type: Input }],
    isSlim: [{ type: Input }],
    menuHoverActive: [{ type: Input }],
    mobileMenuActive: [{ type: Input }],
    portalMenu: [{ type: Input }],
    menuActiveChange: [{ type: Output }],
    mobileMenuActiveChange: [{ type: Output }]
};
export class AppSubMenuComponent {
    constructor(menuService, router) {
        this.menuService = menuService;
        this.router = router;
        this.menuActiveChange = new EventEmitter();
        this.mobileMenuActiveChange = new EventEmitter();
        this.active = false;
    }
    ngOnInit() {
        this.menuSourceSubscription = this.menuService.menuSource$.subscribe(key => {
            // deactivate current active menu
            if (this.active && this.key !== key && key.indexOf(this.key) !== 0) {
                this.active = false;
            }
        });
        this.menuResetSubscription = this.menuService.resetSource$.subscribe(() => {
            this.active = false;
        });
        // TODO Ultima11: Verify if this logic works with our setup
        this.router.events.pipe(filter(event => event instanceof NavigationEnd))
            .subscribe(params => {
            if (this.isSlim) {
                this.active = false;
            }
            else {
                if (this.item.routerLink) {
                    this.updateActiveStateFromRoute();
                }
                else {
                    this.active = false;
                }
            }
        });
        if ((this.isHorizontal || this.isSlim) && this.item.routerLink) {
            this.updateActiveStateFromRoute();
        }
        this.key = this.parentKey ? this.parentKey + '-' + this.index : String(this.index);
    }
    ngOnDestroy() {
        if (this.menuSourceSubscription) {
            this.menuSourceSubscription.unsubscribe();
        }
        if (this.menuResetSubscription) {
            this.menuResetSubscription.unsubscribe();
        }
    }
    updateActiveStateFromRoute() {
        this.active = this.router.isActive(this.item.routerLink[0], !this.item.items);
    }
    itemClick(event) {
        // avoid processing disabled items
        if (this.item.disabled) {
            event.preventDefault();
            return true;
        }
        this.menuService.onMenuStateChange(this.key);
        // execute command
        if (this.item.command) {
            this.item.command({ originalEvent: event, item: this.item });
        }
        if (this.item.items) {
            this.active = !this.active;
        }
        else {
            this.active = true;
            if (this.isHorizontal || this.isSlim) {
                this.menuService.reset();
                this.menuHoverActive = false;
            }
            if (!this.isStatic) {
                this.menuActiveChange.emit(false);
            }
            this.mobileMenuActiveChange.emit(false);
        }
        // prevent hash change
        if (this.item.items || (!this.item.url && !this.item.routerLink)) {
            // TODO https://github.com/primefaces/primeng/issues/8751
            // setTimeout(() => {
            //   this.app.layoutMenuScrollerViewChild.moveBar();
            // }, 450);
            event.preventDefault();
        }
    }
    onMouseEnter() {
        if (this.root &&
            this.menuHoverActive &&
            (this.isHorizontal || this.isSlim) &&
            this.isDesktop) {
            this.menuService.onMenuStateChange(this.key);
            this.active = true;
        }
    }
}
AppSubMenuComponent.decorators = [
    { type: Component, args: [{
                /* eslint-disable @angular-eslint/component-selector */
                selector: '[tk-submenu]',
                /* eslint-enable @angular-eslint/component-selector */
                template: `
    <ng-container>
        <div *ngIf="root">
          <span class="layout-menuitem-text">{{item.label}}</span>
        </div>
        <a [attr.href]="item.url" (click)="itemClick($event)" *ngIf="!item.routerLink || item.items" (keydown.enter)="itemClick($event)"
           [attr.target]="item.target" [attr.tabindex]="0" (mouseenter)="onMouseEnter()" pRipple>
          <i [ngClass]="'pi-' + item.icon" class="layout-menuitem-icon pi pi-fw"></i>
          <span class="layout-menuitem-text">{{item.label}}</span>
          <span class="p-badge p-component p-badge-no-gutter" *ngIf="item.badge && !root">{{item.badge}}</span>
          <i class="pi pi-fw pi-angle-down layout-submenu-toggler" *ngIf="item.items"></i>
        </a>
        <a (click)="itemClick($event)" *ngIf="item.routerLink && !item.items"
           [routerLink]="item.routerLink" routerLinkActive="active-menuitem-routerlink" [routerLinkActiveOptions]="{exact: true}"
           [attr.target]="item.target" [attr.tabindex]="0" (mouseenter)="onMouseEnter()" pRipple>
          <i [ngClass]="'pi-' + item.icon" class="layout-menuitem-icon pi pi-fw"></i>
          <span class="layout-menuitem-text">{{item.label}}</span>
          <span class="p-badge p-component p-badge-no-gutter" *ngIf="item.badge && !root">{{item.badge}}</span>
          <i class="pi pi-fw pi-angle-down layout-submenu-toggler" *ngIf="item.items"></i>
        </a>
        <ul *ngIf="(item.items && root) || (item.items && active)" [@children]="root ? 'visible' : active ? 'visibleAnimated' : 'hiddenAnimated'">
          <ng-template ngFor let-child let-i="index" [ngForOf]="item.items">
            <li tk-submenu [item]="child" [index]="i" [parentKey]="key"></li>
          </ng-template>
        </ul>
    </ng-container>
  `,
                host: {
                    '[class.layout-root-menuitem]': 'root || active',
                    '[class.active-menuitem]': '(active)'
                },
                animations: [
                    trigger('children', [
                        state('void', style({
                            height: '0px',
                            padding: '0px'
                        })),
                        state('hiddenAnimated', style({
                            height: '0px',
                            padding: '0px'
                        })),
                        state('visibleAnimated', style({
                            height: '*'
                        })),
                        state('visible', style({
                            height: '*'
                        })),
                        state('hidden', style({
                            height: '0px',
                            padding: '0px'
                        })),
                        transition('visibleAnimated => hiddenAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                        transition('hiddenAnimated => visibleAnimated', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)')),
                        transition('void => visibleAnimated, visibleAnimated => void', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)'))
                    ])
                ]
            },] }
];
AppSubMenuComponent.ctorParameters = () => [
    { type: MenuService },
    { type: Router }
];
AppSubMenuComponent.propDecorators = {
    item: [{ type: Input }],
    root: [{ type: Input }],
    visible: [{ type: Input }],
    index: [{ type: Input }],
    parentKey: [{ type: Input }],
    menuActive: [{ type: Input }],
    isStatic: [{ type: Input }],
    isHorizontal: [{ type: Input }],
    isMobile: [{ type: Input }],
    isDesktop: [{ type: Input }],
    isSlim: [{ type: Input }],
    menuHoverActive: [{ type: Input }],
    mobileMenuActive: [{ type: Input }],
    menuActiveChange: [{ type: Output }],
    mobileMenuActiveChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9ydGFsLW1lbnUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9ydGFsLWxpYi9zcmMvbGliL3RraXQtcG9ydGFsL2NvbXBvbmVudHMvcG9ydGFsLW1lbnUvcG9ydGFsLW1lbnUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3hGLE9BQU8sRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFFL0UsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLG9DQUFvQyxDQUFBO0FBRTlELE9BQU8sRUFBQyxhQUFhLEVBQUUsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDdEQsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBTXRDLE1BQU0sT0FBTyxnQkFBZ0I7SUFrQzNCO1FBTkEscUJBQWdCLEdBQTBCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFN0QsMkJBQXNCLEdBQTBCLElBQUksWUFBWSxFQUFFLENBQUM7SUFJcEQsQ0FBQztJQWhCaEIsSUFDSSxVQUFVLENBQUMsS0FBaUI7UUFDOUIsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNsQixLQUFLLEVBQUUsTUFBTTtZQUNiLElBQUksRUFBRSxNQUFNO1lBQ1osS0FBSyxFQUFFLEtBQUs7U0FDYixDQUFBO0lBQ0gsQ0FBQzs7O1lBN0JGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsU0FBUztnQkFDbkIsNGRBQXlDO2FBQzFDOzs7O3lCQUVFLEtBQUs7dUJBRUwsS0FBSzsyQkFFTCxLQUFLO3VCQUVMLEtBQUs7d0JBRUwsS0FBSztxQkFFTCxLQUFLOzhCQUVMLEtBQUs7K0JBRUws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QUNmLENBQUMsQ0FBQzt3QkFDSCxVQUFVLENBQUMsbUNBQW1DLEVBQUUsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7d0JBQ2hHLFVBQVUsQ0FBQyxtQ0FBbUMsRUFBRSxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQzt3QkFDaEcsVUFBVSxDQUFDLGtEQUFrRCxFQUN6RCxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDckQsQ0FBQztpQkFDSDthQUNGOzs7WUEzR08sV0FBVztZQUVJLE1BQU07OzttQkEyRzFCLEtBQUs7bUJBRUwsS0FBSztzQkFFTCxLQUFLO29CQUVMLEtBQUs7d0JBRUwsS0FBSzt5QkFFTCxLQUFLO3VCQUVMLEtBQUs7MkJBRUwsS0FBSzt1QkFFTCxLQUFLO3dCQUVMLEtBQUs7cUJBRUwsS0FBSzs4QkFFTCxLQUFLOytCQUVMLEtBQUs7K0JBR0wsTUFBTTtxQ0FFTixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHthbmltYXRlLCBzdGF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIHRyaWdnZXJ9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHtNZW51SXRlbX0gZnJvbSAncHJpbWVuZy9hcGknO1xuaW1wb3J0IHtNZW51U2VydmljZX0gZnJvbSAnLi4vLi4vLi4vYXBpL3NlcnZpY2VzL21lbnUuc2VydmljZSdcbmltcG9ydCB7U3Vic2NyaXB0aW9ufSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHtOYXZpZ2F0aW9uRW5kLCBSb3V0ZXJ9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7ZmlsdGVyfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGstbWVudScsXG4gIHRlbXBsYXRlVXJsOiAncG9ydGFsLW1lbnUuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBBcHBNZW51Q29tcG9uZW50IHtcbiAgQElucHV0KClcbiAgbWVudUFjdGl2ZTogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgaXNTdGF0aWM6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGlzSG9yaXpvbnRhbDogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgaXNNb2JpbGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGlzRGVza3RvcDogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgaXNTbGltOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBtZW51SG92ZXJBY3RpdmU6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIG1vYmlsZU1lbnVBY3RpdmU6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgc2V0IHBvcnRhbE1lbnUoaXRlbXM6IE1lbnVJdGVtW10pIHtcbiAgICB0aGlzLm1lbnVXaXRoUm9vdCA9IHtcbiAgICAgIGxhYmVsOiAnTWVudScsXG4gICAgICBpY29uOiAnbGlzdCcsXG4gICAgICBpdGVtczogaXRlbXNcbiAgICB9XG4gIH1cblxuICBAT3V0cHV0KClcbiAgbWVudUFjdGl2ZUNoYW5nZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KClcbiAgbW9iaWxlTWVudUFjdGl2ZUNoYW5nZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIG1lbnVXaXRoUm9vdDogTWVudUl0ZW07XG5cbiAgY29uc3RydWN0b3IoKSB7fVxufVxuXG5AQ29tcG9uZW50KHtcbiAgLyogZXNsaW50LWRpc2FibGUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvciAqL1xuICBzZWxlY3RvcjogJ1t0ay1zdWJtZW51XScsXG4gIC8qIGVzbGludC1lbmFibGUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvciAqL1xuICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250YWluZXI+XG4gICAgICAgIDxkaXYgKm5nSWY9XCJyb290XCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJsYXlvdXQtbWVudWl0ZW0tdGV4dFwiPnt7aXRlbS5sYWJlbH19PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGEgW2F0dHIuaHJlZl09XCJpdGVtLnVybFwiIChjbGljayk9XCJpdGVtQ2xpY2soJGV2ZW50KVwiICpuZ0lmPVwiIWl0ZW0ucm91dGVyTGluayB8fCBpdGVtLml0ZW1zXCIgKGtleWRvd24uZW50ZXIpPVwiaXRlbUNsaWNrKCRldmVudClcIlxuICAgICAgICAgICBbYXR0ci50YXJnZXRdPVwiaXRlbS50YXJnZXRcIiBbYXR0ci50YWJpbmRleF09XCIwXCIgKG1vdXNlZW50ZXIpPVwib25Nb3VzZUVudGVyKClcIiBwUmlwcGxlPlxuICAgICAgICAgIDxpIFtuZ0NsYXNzXT1cIidwaS0nICsgaXRlbS5pY29uXCIgY2xhc3M9XCJsYXlvdXQtbWVudWl0ZW0taWNvbiBwaSBwaS1md1wiPjwvaT5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImxheW91dC1tZW51aXRlbS10ZXh0XCI+e3tpdGVtLmxhYmVsfX08L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJwLWJhZGdlIHAtY29tcG9uZW50IHAtYmFkZ2Utbm8tZ3V0dGVyXCIgKm5nSWY9XCJpdGVtLmJhZGdlICYmICFyb290XCI+e3tpdGVtLmJhZGdlfX08L3NwYW4+XG4gICAgICAgICAgPGkgY2xhc3M9XCJwaSBwaS1mdyBwaS1hbmdsZS1kb3duIGxheW91dC1zdWJtZW51LXRvZ2dsZXJcIiAqbmdJZj1cIml0ZW0uaXRlbXNcIj48L2k+XG4gICAgICAgIDwvYT5cbiAgICAgICAgPGEgKGNsaWNrKT1cIml0ZW1DbGljaygkZXZlbnQpXCIgKm5nSWY9XCJpdGVtLnJvdXRlckxpbmsgJiYgIWl0ZW0uaXRlbXNcIlxuICAgICAgICAgICBbcm91dGVyTGlua109XCJpdGVtLnJvdXRlckxpbmtcIiByb3V0ZXJMaW5rQWN0aXZlPVwiYWN0aXZlLW1lbnVpdGVtLXJvdXRlcmxpbmtcIiBbcm91dGVyTGlua0FjdGl2ZU9wdGlvbnNdPVwie2V4YWN0OiB0cnVlfVwiXG4gICAgICAgICAgIFthdHRyLnRhcmdldF09XCJpdGVtLnRhcmdldFwiIFthdHRyLnRhYmluZGV4XT1cIjBcIiAobW91c2VlbnRlcik9XCJvbk1vdXNlRW50ZXIoKVwiIHBSaXBwbGU+XG4gICAgICAgICAgPGkgW25nQ2xhc3NdPVwiJ3BpLScgKyBpdGVtLmljb25cIiBjbGFzcz1cImxheW91dC1tZW51aXRlbS1pY29uIHBpIHBpLWZ3XCI+PC9pPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibGF5b3V0LW1lbnVpdGVtLXRleHRcIj57e2l0ZW0ubGFiZWx9fTwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cInAtYmFkZ2UgcC1jb21wb25lbnQgcC1iYWRnZS1uby1ndXR0ZXJcIiAqbmdJZj1cIml0ZW0uYmFkZ2UgJiYgIXJvb3RcIj57e2l0ZW0uYmFkZ2V9fTwvc3Bhbj5cbiAgICAgICAgICA8aSBjbGFzcz1cInBpIHBpLWZ3IHBpLWFuZ2xlLWRvd24gbGF5b3V0LXN1Ym1lbnUtdG9nZ2xlclwiICpuZ0lmPVwiaXRlbS5pdGVtc1wiPjwvaT5cbiAgICAgICAgPC9hPlxuICAgICAgICA8dWwgKm5nSWY9XCIoaXRlbS5pdGVtcyAmJiByb290KSB8fCAoaXRlbS5pdGVtcyAmJiBhY3RpdmUpXCIgW0BjaGlsZHJlbl09XCJyb290ID8gJ3Zpc2libGUnIDogYWN0aXZlID8gJ3Zpc2libGVBbmltYXRlZCcgOiAnaGlkZGVuQW5pbWF0ZWQnXCI+XG4gICAgICAgICAgPG5nLXRlbXBsYXRlIG5nRm9yIGxldC1jaGlsZCBsZXQtaT1cImluZGV4XCIgW25nRm9yT2ZdPVwiaXRlbS5pdGVtc1wiPlxuICAgICAgICAgICAgPGxpIHRrLXN1Ym1lbnUgW2l0ZW1dPVwiY2hpbGRcIiBbaW5kZXhdPVwiaVwiIFtwYXJlbnRLZXldPVwia2V5XCI+PC9saT5cbiAgICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8L3VsPlxuICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5sYXlvdXQtcm9vdC1tZW51aXRlbV0nOiAncm9vdCB8fCBhY3RpdmUnLFxuICAgICdbY2xhc3MuYWN0aXZlLW1lbnVpdGVtXSc6ICcoYWN0aXZlKSdcbiAgfSxcbiAgYW5pbWF0aW9uczogW1xuICAgIHRyaWdnZXIoJ2NoaWxkcmVuJywgW1xuICAgICAgc3RhdGUoJ3ZvaWQnLCBzdHlsZSh7XG4gICAgICAgIGhlaWdodDogJzBweCcsXG4gICAgICAgIHBhZGRpbmc6ICcwcHgnXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgnaGlkZGVuQW5pbWF0ZWQnLCBzdHlsZSh7XG4gICAgICAgIGhlaWdodDogJzBweCcsXG4gICAgICAgIHBhZGRpbmc6ICcwcHgnXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgndmlzaWJsZUFuaW1hdGVkJywgc3R5bGUoe1xuICAgICAgICBoZWlnaHQ6ICcqJ1xuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ3Zpc2libGUnLCBzdHlsZSh7XG4gICAgICAgIGhlaWdodDogJyonXG4gICAgICB9KSksXG4gICAgICBzdGF0ZSgnaGlkZGVuJywgc3R5bGUoe1xuICAgICAgICBoZWlnaHQ6ICcwcHgnLFxuICAgICAgICBwYWRkaW5nOiAnMHB4J1xuICAgICAgfSkpLFxuICAgICAgdHJhbnNpdGlvbigndmlzaWJsZUFuaW1hdGVkID0+IGhpZGRlbkFuaW1hdGVkJywgYW5pbWF0ZSgnNDAwbXMgY3ViaWMtYmV6aWVyKDAuODYsIDAsIDAuMDcsIDEpJykpLFxuICAgICAgdHJhbnNpdGlvbignaGlkZGVuQW5pbWF0ZWQgPT4gdmlzaWJsZUFuaW1hdGVkJywgYW5pbWF0ZSgnNDAwbXMgY3ViaWMtYmV6aWVyKDAuODYsIDAsIDAuMDcsIDEpJykpLFxuICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiB2aXNpYmxlQW5pbWF0ZWQsIHZpc2libGVBbmltYXRlZCA9PiB2b2lkJyxcbiAgICAgICAgICBhbmltYXRlKCc0MDBtcyBjdWJpYy1iZXppZXIoMC44NiwgMCwgMC4wNywgMSknKSlcbiAgICBdKVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIEFwcFN1Yk1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpIGl0ZW06IE1lbnVJdGVtO1xuXG4gIEBJbnB1dCgpIHJvb3Q6IGJvb2xlYW47XG5cbiAgQElucHV0KCkgdmlzaWJsZTogYm9vbGVhbjtcblxuICBASW5wdXQoKSBpbmRleDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHBhcmVudEtleTogc3RyaW5nO1xuXG4gIEBJbnB1dCgpXG4gIG1lbnVBY3RpdmU6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGlzU3RhdGljOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBpc0hvcml6b250YWw6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGlzTW9iaWxlOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBpc0Rlc2t0b3A6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGlzU2xpbTogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgbWVudUhvdmVyQWN0aXZlOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBtb2JpbGVNZW51QWN0aXZlOiBib29sZWFuO1xuXG4gIEBPdXRwdXQoKVxuICBtZW51QWN0aXZlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKVxuICBtb2JpbGVNZW51QWN0aXZlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgYWN0aXZlID0gZmFsc2U7XG5cbiAgbWVudVNvdXJjZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIG1lbnVSZXNldFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGtleTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlLCBwcml2YXRlIHJvdXRlcjogUm91dGVyKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMubWVudVNvdXJjZVN1YnNjcmlwdGlvbiA9IHRoaXMubWVudVNlcnZpY2UubWVudVNvdXJjZSQuc3Vic2NyaWJlKGtleSA9PiB7XG4gICAgICAvLyBkZWFjdGl2YXRlIGN1cnJlbnQgYWN0aXZlIG1lbnVcbiAgICAgIGlmICh0aGlzLmFjdGl2ZSAmJiB0aGlzLmtleSAhPT0ga2V5ICYmIGtleS5pbmRleE9mKHRoaXMua2V5KSAhPT0gMCkge1xuICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5tZW51UmVzZXRTdWJzY3JpcHRpb24gPSB0aGlzLm1lbnVTZXJ2aWNlLnJlc2V0U291cmNlJC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICB9KVxuXG4gICAgLy8gVE9ETyBVbHRpbWExMTogVmVyaWZ5IGlmIHRoaXMgbG9naWMgd29ya3Mgd2l0aCBvdXIgc2V0dXBcbiAgICB0aGlzLnJvdXRlci5ldmVudHMucGlwZShmaWx0ZXIoZXZlbnQgPT4gZXZlbnQgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRW5kKSlcbiAgICAgICAgLnN1YnNjcmliZShwYXJhbXMgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmlzU2xpbSkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5yb3V0ZXJMaW5rKSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlQWN0aXZlU3RhdGVGcm9tUm91dGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIGlmICgodGhpcy5pc0hvcml6b250YWwgfHwgdGhpcy5pc1NsaW0pICYmIHRoaXMuaXRlbS5yb3V0ZXJMaW5rKSB7XG4gICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVN0YXRlRnJvbVJvdXRlKClcbiAgICB9XG5cbiAgICB0aGlzLmtleSA9IHRoaXMucGFyZW50S2V5ID8gdGhpcy5wYXJlbnRLZXkgKyAnLScgKyB0aGlzLmluZGV4IDogU3RyaW5nKHRoaXMuaW5kZXgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMubWVudVNvdXJjZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5tZW51U291cmNlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubWVudVJlc2V0U3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLm1lbnVSZXNldFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUFjdGl2ZVN0YXRlRnJvbVJvdXRlKCkge1xuICAgIHRoaXMuYWN0aXZlID0gdGhpcy5yb3V0ZXIuaXNBY3RpdmUodGhpcy5pdGVtLnJvdXRlckxpbmtbMF0sICF0aGlzLml0ZW0uaXRlbXMpO1xuICB9XG5cblxuICBpdGVtQ2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgLy8gYXZvaWQgcHJvY2Vzc2luZyBkaXNhYmxlZCBpdGVtc1xuICAgIGlmICh0aGlzLml0ZW0uZGlzYWJsZWQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLm1lbnVTZXJ2aWNlLm9uTWVudVN0YXRlQ2hhbmdlKHRoaXMua2V5KVxuXG4gICAgLy8gZXhlY3V0ZSBjb21tYW5kXG4gICAgaWYgKHRoaXMuaXRlbS5jb21tYW5kKSB7XG4gICAgICB0aGlzLml0ZW0uY29tbWFuZCh7IG9yaWdpbmFsRXZlbnQ6IGV2ZW50LCBpdGVtOiB0aGlzLml0ZW0gfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXRlbS5pdGVtcykge1xuICAgICAgdGhpcy5hY3RpdmUgPSAhdGhpcy5hY3RpdmU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaXNIb3Jpem9udGFsIHx8IHRoaXMuaXNTbGltKSB7XG4gICAgICAgIHRoaXMubWVudVNlcnZpY2UucmVzZXQoKTtcbiAgICAgICAgdGhpcy5tZW51SG92ZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLmlzU3RhdGljKSB7XG4gICAgICAgIHRoaXMubWVudUFjdGl2ZUNoYW5nZS5lbWl0KGZhbHNlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5tb2JpbGVNZW51QWN0aXZlQ2hhbmdlLmVtaXQoZmFsc2UpO1xuICAgIH1cblxuICAgIC8vIHByZXZlbnQgaGFzaCBjaGFuZ2VcbiAgICBpZiAodGhpcy5pdGVtLml0ZW1zIHx8ICghdGhpcy5pdGVtLnVybCAmJiAhdGhpcy5pdGVtLnJvdXRlckxpbmspKSB7XG4gICAgICAvLyBUT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9wcmltZWZhY2VzL3ByaW1lbmcvaXNzdWVzLzg3NTFcbiAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gICB0aGlzLmFwcC5sYXlvdXRNZW51U2Nyb2xsZXJWaWV3Q2hpbGQubW92ZUJhcigpO1xuICAgICAgLy8gfSwgNDUwKTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZUVudGVyKCkge1xuICAgIGlmIChcbiAgICAgIHRoaXMucm9vdCAmJlxuICAgICAgdGhpcy5tZW51SG92ZXJBY3RpdmUgJiZcbiAgICAgICh0aGlzLmlzSG9yaXpvbnRhbCB8fCB0aGlzLmlzU2xpbSkgJiZcbiAgICAgIHRoaXMuaXNEZXNrdG9wXG4gICAgKSB7XG4gICAgICB0aGlzLm1lbnVTZXJ2aWNlLm9uTWVudVN0YXRlQ2hhbmdlKHRoaXMua2V5KTtcbiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxufVxuIl19